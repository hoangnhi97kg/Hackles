
  _    _            _    _
 | |  | |          | |  | |
 | |__| | __ _  ___| | _| | ___  ___
 |  __  |/ _` |/ __| |/ / |/ _ \/ __|
 | |  | | (_| | (__|   <| |  __/\__ \
 |_|  |_|\__,_|\___|_|\_\_|\___||___/
    

[*] Connecting to bolt://127.0.0.1:7687...
[+] Connected successfully
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:Tag_Owned OR 'owned' IN n.system_tags OR n.owned = true)
    RETURN n.name AS name,
           COALESCE(n.admincount, false) AS is_admin
    
[DEBUG] Query completed in 0.00s
[*] Running all 150 queries...

[*] Domains
[DEBUG] Query: 
        MATCH (d:Domain)
        RETURN d.name AS name, d.functionallevel AS level, d.objectid AS objectid
        ORDER BY d.name
        
[DEBUG] Query completed in 0.00s
    Found 1 domain(s)
+-------------------+------------------+-------------------------------------------+
| Domain            | Functional Level | SID                                       |
+-------------------+------------------+-------------------------------------------+
| HACKSMARTER.LOCAL | 2016             | S-1-5-21-3154413470-3340737026-2748725799 |
+-------------------+------------------+-------------------------------------------+
    This query may take a while on large datasets...
[DEBUG] Query: 
    MATCH (n)-[r]->(m)
    WHERE type(r) IN ['GenericAll', 'WriteDacl', 'WriteOwner', 'GenericWrite',
                       'ForceChangePassword', 'AddMember', 'AllExtendedRights',
                       'AddSelf', 'WriteSPN', 'AddKeyCredentialLink']
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        type(r) AS permission,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type
    ORDER BY type(r), n.name
    LIMIT 500
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Dangerous ACL Relationships
    Found 4 dangerous ACL relationship(s) (limit 500)
+---------------------------------------+-------+--------------+----------------------------------------------------+-------------+
| Principal                             | Type  | Permission   | Target                                             | Target Type |
+---------------------------------------+-------+--------------+----------------------------------------------------+-------------+
| ALT.SVC@HACKSMARTER.LOCAL             | User  | GenericAll   | YORINOBU@HACKSMARTER.LOCAL                         | User        |
| YORINOBU@HACKSMARTER.LOCAL            | User  | GenericWrite | SOULKILLER.SVC@HACKSMARTER.LOCAL                   | User        |
| RAS AND IAS SERVERS@HACKSMARTER.LOCAL | Group | WriteDacl    | RAS AND IAS SERVERS ACCESS CHECK@HACKSMARTER.LOCAL | Container   |
| RAS AND IAS SERVERS@HACKSMARTER.LOCAL | Group | WriteOwner   | RAS AND IAS SERVERS ACCESS CHECK@HACKSMARTER.LOCAL | Container   |
+---------------------------------------+-------+--------------+----------------------------------------------------+-------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:AddAllowedToAct]->(c:Computer)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    
    RETURN
        n.name AS principal,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' WHEN n:Group THEN 'Group' ELSE 'Other' END AS principal_type,
        c.name AS target,
        c.operatingsystem AS os
    ORDER BY n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] AddAllowedToAct (RBCD Setup)
    Found 0 AddAllowedToAct permission(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:AddMember]->(g:Group)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        g.name AS target_group,
        CASE WHEN g.admincount = true THEN 'Yes' ELSE 'No' END AS group_is_admin,
        CASE
            WHEN g.objectid ENDS WITH '-512' THEN 'Domain Admins'
            WHEN g.objectid ENDS WITH '-519' THEN 'Enterprise Admins'
            WHEN g.objectid ENDS WITH '-544' THEN 'Administrators'
            ELSE ''
        END AS special_group
    ORDER BY g.admincount DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] AddMember ACL Abuse
    Found 0 AddMember relationship(s) from non-admin principals (limit 200)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r:GenericAll|WriteDacl|WriteOwner|Owns]->(ou:OU)
    WHERE NOT n.objectid ENDS WITH '-512'
      AND NOT n.objectid ENDS WITH '-519'
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, type(r) AS permission, ou.name AS ou_name
    ORDER BY ou.name
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Container/OU ACL Abuse
    Found 2 dangerous OU ACL(s)
    [!] ACLs on OUs may inherit to all child objects!
+----------------------------------+-------+------------+--------------------------------------+
| Principal                        | Type  | Permission | OU                                   |
+----------------------------------+-------+------------+--------------------------------------+
| ADMINISTRATORS@HACKSMARTER.LOCAL | Group | WriteOwner | DOMAIN CONTROLLERS@HACKSMARTER.LOCAL |
| ADMINISTRATORS@HACKSMARTER.LOCAL | Group | WriteDacl  | DOMAIN CONTROLLERS@HACKSMARTER.LOCAL |
+----------------------------------+-------+------------+--------------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH p=(g:Group)-[r:Owns|WriteDacl|GenericAll|WriteOwner|ExecuteDCOM|GenericWrite|AllowedToDelegate|ForceChangePassword|AddMember|AllExtendedRights]->(n)
    WHERE g.objectid ENDS WITH '-513'
    
    RETURN type(r) AS edge,
           CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS target_type,
           n.name AS target
    ORDER BY edge, target
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Domain Users Dangerous ACLs
    Found 0 dangerous ACL(s) for Domain Users
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ForceChangePassword]->(m:User)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        m.name AS target,
        CASE WHEN m.enabled = false THEN 'Disabled' ELSE 'Enabled' END AS target_status,
        CASE WHEN m.admincount = true THEN 'Yes' ELSE 'No' END AS target_is_admin,
        CASE WHEN m.hasspn = true THEN 'Yes' ELSE 'No' END AS has_spn
    ORDER BY m.admincount DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] ForceChangePassword Targets
    Found 0 ForceChangePassword relationship(s) from non-admin principals (limit 200)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:GenericAll]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type,
        CASE WHEN m.enabled = false THEN 'Disabled' ELSE 'Enabled' END AS target_status,
        CASE WHEN m.admincount = true THEN 'Yes' ELSE 'No' END AS target_is_admin
    ORDER BY m.admincount DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] [CRITICAL] GenericAll ACL Abuse
    Found 1 GenericAll relationship(s) from non-admin principals (limit 200)
+---------------------------+------+----------------------------+-------------+---------+-------+
| Principal                 | Type | Target                     | Target Type | Status  | Admin |
+---------------------------+------+----------------------------+-------------+---------+-------+
| ALT.SVC@HACKSMARTER.LOCAL | User | YORINOBU@HACKSMARTER.LOCAL | User        | Enabled | No    |
+---------------------------+------+----------------------------+-------------+---------+-------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:GenericWrite]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type,
        CASE WHEN m.enabled = false THEN 'Disabled' ELSE 'Enabled' END AS target_status,
        CASE WHEN m.admincount = true THEN 'Yes' ELSE 'No' END AS target_is_admin
    ORDER BY m.admincount DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] GenericWrite ACL Abuse
    Found 1 GenericWrite relationship(s) from non-admin principals (limit 200)
+----------------------------+------+----------------------------------+-------------+---------+-------+
| Principal                  | Type | Target                           | Target Type | Status  | Admin |
+----------------------------+------+----------------------------------+-------------+---------+-------+
| YORINOBU@HACKSMARTER.LOCAL | User | SOULKILLER.SVC@HACKSMARTER.LOCAL | User        | Enabled | No    |
+----------------------------+------+----------------------------------+-------------+---------+-------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r:GenericAll|GenericWrite|WriteDacl|WriteOwner|Owns]->(gpo:GPO)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    
    RETURN
        n.name AS principal,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' WHEN n:Group THEN 'Group' ELSE 'Other' END AS principal_type,
        type(r) AS permission,
        gpo.name AS gpo_name
    ORDER BY n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Non-Admin GPO Control
    Found 0 non-admin GPO control relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:GPO)
    WHERE g.name =~ '(?i).*(password|credential|admin|service|deploy|install|laps|bitlocker|firewall|antivirus).*'
    
    RETURN g.name AS gpo, g.gpcpath AS path
    ORDER BY g.name
    
[DEBUG] Query completed in 0.00s

[*] GPO Interesting Names
    Found 0 GPO(s) with interesting names
    [0.00s]
[DEBUG] Query: 
    MATCH (gpo:GPO)-[:GpLink]->(ou)
    WHERE toUpper(ou.name) CONTAINS 'DOMAIN CONTROLLERS'
    OR toUpper(ou.distinguishedname) CONTAINS 'OU=DOMAIN CONTROLLERS'
    
    OPTIONAL MATCH (controller)-[r]->(gpo)
    WHERE r.isacl = true AND type(r) IN ['GenericAll', 'WriteDacl', 'WriteOwner', 'Owns', 'GenericWrite']
    WITH gpo, ou, COLLECT(DISTINCT controller.name) AS all_controllers
    RETURN
        gpo.name AS gpo_name,
        ou.name AS linked_to,
        all_controllers[0..3] AS controllers,
        size(all_controllers) AS controller_count,
        gpo.gpcpath AS gpo_path
    ORDER BY gpo.name
    
[DEBUG] Query completed in 0.00s

[*] GPOs on DC OU
    Found 0 GPO(s) linked to Domain Controllers OU
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:ReadLAPSPassword]->(c:Computer)
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        c.name AS computer
    ORDER BY n.name, c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] LAPS Password Readers
    Found 0 LAPS read permission(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:Owns]->(m)
    WHERE NOT n.objectid ENDS WITH '-512'
      AND NOT n.objectid ENDS WITH '-519'
      AND NOT n.objectid ENDS WITH '-544'
    
    RETURN n.name AS owner, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS owner_type,
           m.name AS owned_object, CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS object_type
    ORDER BY CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Owns Relationships
    Found 0 ownership relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r]->(m)
    WHERE r.isacl = true
    
    WITH n, COLLECT(DISTINCT m.name)[0..5] AS sample_targets, COUNT(DISTINCT m) AS controlled
    WHERE controlled > 10
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, controlled AS objects_controlled, sample_targets
    ORDER BY controlled DESC
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Top ACL Controllers
    Found 6 principal(s) controlling 10+ objects
+-----------------------------------------+-------+-------+----------------------------------------------------+
| Principal                               | Type  | Count | Sample Targets                                     |
+-----------------------------------------+-------+-------+----------------------------------------------------+
| DOMAIN ADMINS@HACKSMARTER.LOCAL         | Group | 86    | DC01.HACKSMARTER.LOCAL, ODA@HACKSMARTER.LOCAL,     |
|                                         |       |       | HELLMAN@HACKSMARTER.LOCAL (+2 more)                |
| ENTERPRISE ADMINS@HACKSMARTER.LOCAL     | Group | 86    | SCHEMA ADMINS@HACKSMARTER.LOCAL,                   |
|                                         |       |       | THE_EMPEROR@HACKSMARTER.LOCAL,                     |
|                                         |       |       | KRBTGT@HACKSMARTER.LOCAL (+2 more)                 |
| ADMINISTRATORS@HACKSMARTER.LOCAL        | Group | 79    | HACKSMARTER.LOCAL, DISTRIBUTED COM                 |
|                                         |       |       | USERS@HACKSMARTER.LOCAL, GUEST@HACKSMARTER.LOCAL   |
|                                         |       |       | (+2 more)                                          |
| ACCOUNT OPERATORS@HACKSMARTER.LOCAL     | Group | 47    | SMASHER@HACKSMARTER.LOCAL,                         |
|                                         |       |       | FARADAY@HACKSMARTER.LOCAL,                         |
|                                         |       |       | HANAKO@HACKSMARTER.LOCAL (+2 more)                 |
| KEY ADMINS@HACKSMARTER.LOCAL            | Group | 13    | ALT.SVC@HACKSMARTER.LOCAL,                         |
|                                         |       |       | SOULKILLER.SVC@HACKSMARTER.LOCAL,                  |
|                                         |       |       | SMASHER@HACKSMARTER.LOCAL (+2 more)                |
| ENTERPRISE KEY ADMINS@HACKSMARTER.LOCAL | Group | 13    | ODA@HACKSMARTER.LOCAL, HELLMAN@HACKSMARTER.LOCAL,  |
|                                         |       |       | KEI.SVC@HACKSMARTER.LOCAL (+2 more)                |
+-----------------------------------------+-------+-------+----------------------------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r]->(target)
    WHERE n.name STARTS WITH 'S-1-'
    AND type(r) IN ['GenericAll', 'GenericWrite', 'WriteDacl', 'WriteOwner', 'Owns', 'ForceChangePassword', 'AddMember', 'AllExtendedRights', 'AddSelf']
    
    RETURN DISTINCT
        n.name AS unresolved_sid,
        n.objectid AS sid,
        type(r) AS permission,
        target.name AS target,
        CASE WHEN target:User THEN 'User' WHEN target:Group THEN 'Group' WHEN target:Computer THEN 'Computer' WHEN target:Domain THEN 'Domain' ELSE 'Other' END AS target_type
    ORDER BY type(r), target.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Unresolved SIDs with Outbound Control
    Found 0 unresolved SID(s) with dangerous permissions
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:WriteAccountRestrictions]->(c:Computer)
    WHERE NOT n.objectid ENDS WITH '-512'
      AND NOT n.objectid ENDS WITH '-519'
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, c.name AS target
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s

[*] WriteAccountRestrictions
    Found 0 WriteAccountRestrictions relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:WriteDacl]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type,
        CASE WHEN m.enabled = false THEN 'Disabled' ELSE 'Enabled' END AS target_status,
        CASE WHEN m.admincount = true THEN 'Yes' ELSE 'No' END AS target_is_admin
    ORDER BY m.admincount DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] WriteDacl ACL Abuse
    Found 1 WriteDacl relationship(s) from non-admin principals (limit 200)
+---------------------------------------+-------+----------------------------------------------------+-------------+---------+-------+
| Principal                             | Type  | Target                                             | Target Type | Status  | Admin |
+---------------------------------------+-------+----------------------------------------------------+-------------+---------+-------+
| RAS AND IAS SERVERS@HACKSMARTER.LOCAL | Group | RAS AND IAS SERVERS ACCESS CHECK@HACKSMARTER.LOCAL | Container   | Enabled | No    |
+---------------------------------------+-------+----------------------------------------------------+-------------+---------+-------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:WriteSPN]->(target:User)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND target.enabled = true
    
    RETURN
        n.name AS principal,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' WHEN n:Group THEN 'Group' ELSE 'Other' END AS principal_type,
        target.name AS target,
        target.hasspn AS has_spn,
        target.admincount AS target_admin
    ORDER BY target.admincount DESC, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] WriteSPN Permissions
    Found 0 WriteSPN permission(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)-[:MemberOf*2..]->(g:Group)-[:AdminTo]->(c:Computer)
    WHERE u.admincount = false OR u.admincount IS NULL
    
    WITH u, COLLECT(DISTINCT c.name)[0..5] AS sample_computers, count(DISTINCT c) AS admin_count
    WHERE admin_count > 0
    RETURN u.name AS user, admin_count AS computers_admin_to, sample_computers
    ORDER BY admin_count DESC
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Shadow Admins (Nested Group Memberships)
    Found 0 user(s) with indirect admin rights
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:MemberOf|GetChanges|GetChangesAll*1..]->(d:Domain)
    WHERE (n:User OR n:Group OR n:Computer)
    AND NOT EXISTS {
        MATCH (n)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    }
    
    WITH n, d
    MATCH (n)-[r:GetChanges|GetChangesAll]->(d)
    WITH n, d, collect(type(r)) AS rights
    WHERE 'GetChanges' IN rights OR 'GetChangesAll' IN rights
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, d.name AS domain,
           'GetChanges' IN rights AS has_getchanges,
           'GetChangesAll' IN rights AS has_getchangesall,
           n.enabled AS enabled
    ORDER BY type, n.name
    
[DEBUG] Query completed in 0.00s

[*] [CRITICAL] Non-Admin DCSync Principals
    Found 4 non-admin principal(s) with DCSync rights
    [!] CRITICAL: These principals can DCSync but are NOT Domain Admins!
        Often overlooked in security reviews. May be service accounts or misconfigurations.
        Breakdown: 0 users, 4 groups, 0 computers
+----------------------------------------------------+-------+-------------------+------------+---------------+---------+
| Principal                                          | Type  | Domain            | GetChanges | GetChangesAll | Enabled |
+----------------------------------------------------+-------+-------------------+------------+---------------+---------+
| ADMINISTRATORS@HACKSMARTER.LOCAL                   | Group | HACKSMARTER.LOCAL | True       | True          | -       |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | Group | HACKSMARTER.LOCAL | False      | True          | -       |
| ENTERPRISE DOMAIN CONTROLLERS@HACKSMARTER.LOCAL    | Group | HACKSMARTER.LOCAL | True       | False         | -       |
| ENTERPRISE READ-ONLY DOMAIN CONTROLLERS@HACKSMA... | Group | HACKSMARTER.LOCAL | True       | False         | -       |
+----------------------------------------------------+-------+-------------------+------------+---------------+---------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:AllExtendedRights]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND n.enabled <> false
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'NETWORK SERVICE@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type,
        CASE WHEN m.enabled = false THEN 'Disabled' ELSE 'Enabled' END AS target_status,
        CASE WHEN m.admincount = true THEN 'Yes' ELSE 'No' END AS target_is_admin,
        CASE WHEN 'admin_tier_0' IN m.system_tags OR m:Tag_Tier_Zero THEN 'T0' ELSE '' END AS tier_zero
    ORDER BY m.admincount DESC, tier_zero DESC, n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] AllExtendedRights ACL Abuse
    Found 0 AllExtendedRights relationship(s) from non-admin principals (limit 200)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r:WriteDacl|WriteOwner|GenericAll|Owns]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND n.enabled <> false
    AND (
        m.name CONTAINS 'SCHEMA' OR
        m.name CONTAINS 'CONFIGURATION' OR
        m.name CONTAINS 'SITES' OR
        m.distinguishedname CONTAINS 'CN=Schema,CN=Configuration' OR
        m.distinguishedname CONTAINS 'CN=Configuration,DC=' OR
        m.distinguishedname CONTAINS 'CN=Sites,CN=Configuration' OR
        m.distinguishedname CONTAINS 'CN=Services,CN=Configuration'
    )
    AND NOT n.name STARTS WITH 'SYSTEM@'
    AND NOT n.name STARTS WITH 'LOCAL SERVICE@'
    AND NOT n.name STARTS WITH 'ENTERPRISE ADMINS@'
    AND NOT n.name STARTS WITH 'DOMAIN ADMINS@'
    AND NOT n.name STARTS WITH 'SCHEMA ADMINS@'
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS principal_type,
        type(r) AS permission,
        m.name AS target,
        CASE
        WHEN m:User THEN 'User'
        WHEN m:Group THEN 'Group'
        WHEN m:Computer THEN 'Computer'
        WHEN m:Domain THEN 'Domain'
        WHEN m:GPO THEN 'GPO'
        WHEN m:OU THEN 'OU'
        WHEN m:Container THEN 'Container'
        WHEN m:EnterpriseCA THEN 'EnterpriseCA'
        WHEN m:CertTemplate THEN 'CertTemplate'
        WHEN m:NTAuthStore THEN 'NTAuthStore'
        WHEN m:RootCA THEN 'RootCA'
        WHEN m:AIACA THEN 'AIACA'
        ELSE labels(m)[0]
    END AS target_type,
        COALESCE(m.distinguishedname, 'N/A') AS target_dn
    ORDER BY permission, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Schema/Configuration Partition Control
    Found 0 principal(s) with control over critical AD partitions
    [0.00s]
[DEBUG] Query: 
    MATCH (eca:EnterpriseCA)
    WHERE eca.isuserspecifiessanenabled = true
    
    RETURN eca.name AS ca, eca.dnshostname AS host
    ORDER BY eca.name
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC11 (User SAN Enabled)
    Found 0 CA(s) with user-specified SAN enabled
    [0.00s]
[DEBUG] Query: 
    MATCH (eca:EnterpriseCA)
    WHERE eca.webenrollmentenabled = true
    
    RETURN eca.name AS ca, eca.dnshostname AS host
    ORDER BY eca.name
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC8 (Web Enrollment)
    Found 0 CA(s) with web enrollment enabled
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[r:ADCSESC1|ADCSESC3|ADCSESC4|ADCSESC5|ADCSESC6a|ADCSESC6b|ADCSESC7|ADCSESC9a|ADCSESC9b|ADCSESC10a|ADCSESC10b|ADCSESC13]->(m)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    
    OPTIONAL MATCH (m)-[:PublishedTo]->(ca:EnterpriseCA)
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        type(r) AS escalation,
        m.name AS target,
        ca.name AS ca
    ORDER BY type(r), n.name
    LIMIT 200
    
[DEBUG] Query completed in 0.00s

[*] ADCS Escalation Paths (ESC1-ESC13)
    Found 0 ADCS escalation path(s) (limit 200)
    [0.00s]
[DEBUG] Query: 
    MATCH (ca:EnterpriseCA)
    
    RETURN
        ca.name AS name,
        ca.domain AS domain,
        ca.caname AS caname
    ORDER BY ca.name
    
[DEBUG] Query completed in 0.00s

[*] ADCS - Certificate Authorities
    Found 0 Enterprise CA(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u)-[:Enroll]->(c:CertTemplate)
    WHERE '2.5.29.37.0' IN c.effectiveekus
    AND NOT u.objectid ENDS WITH '-512'
    AND NOT u.objectid ENDS WITH '-519'
    
    OPTIONAL MATCH (c)-[:PublishedTo]->(ca:EnterpriseCA)
    RETURN
        u.name AS principal,
        CASE
        WHEN u:User THEN 'User'
        WHEN u:Group THEN 'Group'
        WHEN u:Computer THEN 'Computer'
        WHEN u:Domain THEN 'Domain'
        WHEN u:GPO THEN 'GPO'
        WHEN u:OU THEN 'OU'
        WHEN u:Container THEN 'Container'
        WHEN u:EnterpriseCA THEN 'EnterpriseCA'
        WHEN u:CertTemplate THEN 'CertTemplate'
        WHEN u:NTAuthStore THEN 'NTAuthStore'
        WHEN u:RootCA THEN 'RootCA'
        WHEN u:AIACA THEN 'AIACA'
        ELSE labels(u)[0]
    END AS type,
        c.name AS template,
        ca.name AS ca
    ORDER BY c.name, u.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC2/ESC3 - Any Purpose Templates
    Found 0 enrollment right(s) on Any Purpose templates (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (ct:CertTemplate)-[:PublishedTo]->(ca:EnterpriseCA)
    WHERE ct.schemaversion = 1
    AND ct.enrolleesuppliessubject = true
    
    RETURN ct.name AS template, ct.schemaversion AS version, ca.name AS ca, ct.domain AS domain
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC15 Vulnerable Templates (CVE-2024-49019)
    Found 0 ESC15 vulnerable template(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC1]->(m:CertTemplate)
    OPTIONAL MATCH (m)-[:PublishedTo]->(ca:EnterpriseCA)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        m.name AS template,
        ca.name AS ca
    ORDER BY m.name, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC1 - Vulnerable Templates
    Found 0 ESC1 path(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (u)-[:Enroll]->(c:CertTemplate)
    WHERE '1.3.6.1.4.1.311.20.2.1' IN c.effectiveekus
    AND (u.admincount IS NULL OR u.admincount = false)
    AND NOT u.objectid ENDS WITH '-512'
    AND NOT u.objectid ENDS WITH '-519'
    
    OPTIONAL MATCH (c)-[:PublishedTo]->(ca:EnterpriseCA)
    RETURN
        u.name AS principal,
        CASE
        WHEN u:User THEN 'User'
        WHEN u:Group THEN 'Group'
        WHEN u:Computer THEN 'Computer'
        WHEN u:Domain THEN 'Domain'
        WHEN u:GPO THEN 'GPO'
        WHEN u:OU THEN 'OU'
        WHEN u:Container THEN 'Container'
        WHEN u:EnterpriseCA THEN 'EnterpriseCA'
        WHEN u:CertTemplate THEN 'CertTemplate'
        WHEN u:NTAuthStore THEN 'NTAuthStore'
        WHEN u:RootCA THEN 'RootCA'
        WHEN u:AIACA THEN 'AIACA'
        ELSE labels(u)[0]
    END AS type,
        c.name AS template,
        ca.name AS ca
    ORDER BY c.name, u.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC3 - Enrollment Agent Templates
    Found 0 enrollment right(s) on Enrollment Agent templates (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC4]->(t:CertTemplate)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        t.name AS template,
        t.displayname AS display_name
    ORDER BY t.name, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC4 - Template ACL Abuse
    Found 0 ESC4 path(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r]->(ca:EnterpriseCA)
    WHERE type(r) IN ['GenericAll', 'GenericWrite', 'WriteDacl', 'WriteOwner', 'Owns']
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        type(r) AS permission,
        ca.name AS target
    ORDER BY ca.name, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC5 - PKI Object Control
    Found 0 ESC5 path(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC6a]->(ca:EnterpriseCA)
    OPTIONAL MATCH (t:CertTemplate)-[:PublishedTo]->(ca)
    WHERE t.authenticationenabled = true
    
    WITH n, ca, COLLECT(DISTINCT t.name)[0..3] AS usable_templates
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        ca.name AS ca_name,
        usable_templates,
        'ESC6a' AS variant
    ORDER BY ca.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC6b]->(ca:EnterpriseCA)
    OPTIONAL MATCH (t:CertTemplate)-[:PublishedTo]->(ca)
    WHERE t.authenticationenabled = true
    
    WITH n, ca, COLLECT(DISTINCT t.name)[0..3] AS usable_templates
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        ca.name AS ca_name,
        usable_templates,
        'ESC6b' AS variant
    ORDER BY ca.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC6 - SAN Flag Enabled
    Found 0 ESC6 path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC9a]->(t:CertTemplate)
    OPTIONAL MATCH (t)-[:PublishedTo]->(ca:EnterpriseCA)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        t.name AS template,
        ca.name AS ca,
        'ESC9a' AS variant
    ORDER BY t.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC9b]->(t:CertTemplate)
    OPTIONAL MATCH (t)-[:PublishedTo]->(ca:EnterpriseCA)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        t.name AS template,
        ca.name AS ca,
        'ESC9b' AS variant
    ORDER BY t.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC9 - No Security Extension
    Found 0 ESC9 path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC10a]->(t)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        t.name AS target,
        'ESC10a' AS variant
    ORDER BY t.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC10b]->(t)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        t.name AS target,
        'ESC10b' AS variant
    ORDER BY t.name, n.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC10 - Weak Certificate Mapping
    Found 0 ESC10 path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ADCSESC13]->(g:Group)
    
    RETURN DISTINCT
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        g.name AS linked_group,
        g.highvalue AS high_value
    ORDER BY g.highvalue DESC, g.name, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS ESC13 - Issuance Policy Abuse
    Found 0 ESC13 path(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH p=(c:Computer)-[:GoldenCert]->(d:Domain)
    
    RETURN c.name AS ca_host, d.name AS domain
    
[DEBUG] Query completed in 0.00s

[*] Golden Certificate Paths
    Found 0 Golden Certificate path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ManageCA]->(ca:EnterpriseCA)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.objectid ENDS WITH '-512'
    AND NOT n.objectid ENDS WITH '-519'
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, ca.name AS ca
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] ADCS ManageCA Rights (ESC7)
    Found 0 ManageCA right(s) for non-admins
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:Enroll|AutoEnroll]->(ct:CertTemplate)-[:PublishedTo]->(ca:EnterpriseCA)
    WHERE ct.enrolleesuppliessubject = true
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        ct.name AS template,
        ca.name AS ca
    ORDER BY ct.name, n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] ADCS - Enrollment on Vulnerable Templates
    Found 0 vulnerable enrollment right(s) (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.name =~ '(?i).*AAD.*CONNECT.*|.*AZURE.*AD.*|.*AADC.*'
       OR ANY(spn IN COALESCE(c.serviceprincipalnames, []) WHERE toUpper(spn) CONTAINS 'AZUREADSSOACC')
    
    RETURN c.name AS server, c.operatingsystem AS os
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] Azure AD Connect Servers
    Found 0 potential AAD Connect server(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:User OR n:Computer)
    AND (n.name =~ '(?i).*MSOL_.*' OR n.name =~ '(?i).*AAD_.*' OR n.name =~ '(?i).*SYNC_.*' OR n.name =~ '(?i).*AZUREADSSOACC.*')
    
    RETURN
        n.name AS name,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' ELSE 'Other' END AS type,
        n.enabled AS enabled,
        n.admincount AS admincount,
        n.description AS description
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s

[*] Azure AD Connect Accounts
    Found 0 Azure AD Connect / MSOL / Sync account(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r:GetChanges|GetChangesAll|DCSync]->(d:Domain)
    WHERE n.name =~ '(?i).*(MSOL_|AAD_|SYNC_|AZUREADSSOACC).*'
    
    RETURN DISTINCT
        n.name AS name,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' ELSE 'Other' END AS type,
        type(r) AS permission,
        d.name AS target_domain
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s

[*] AAD Connect with DCSync
    Found 0 Azure AD account(s) with DCSync rights
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {dontreqpreauth: true})
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.enabled AS enabled,
        u.admincount AS admincount,
        u.description AS description
    ORDER BY u.admincount DESC, u.name
    LIMIT 1000
    
[DEBUG] Query completed in 0.00s

[*] AS-REP Roastable Users (Pre-Auth Disabled)
    Found 0 AS-REP roastable user(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:DCSync|GetChanges|GetChangesAll]->(d:Domain)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT n.name STARTS WITH 'ENTERPRISE DOMAIN CONTROLLERS@'
    AND NOT n.name STARTS WITH 'ENTERPRISE READ-ONLY DOMAIN CONTROLLERS@'
    AND NOT n.objectid ENDS WITH '-516'
    AND NOT n.objectid ENDS WITH '-521'
    
    RETURN DISTINCT
        n.name AS name,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        d.name AS domain
    ORDER BY n.name
    LIMIT 1000
    
[DEBUG] Query completed in 0.00s

[*] DCSync Privileges (Non-Admin)
    Found 0 non-admin principal(s) with DCSync rights
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[r:DCSync|GetChanges|GetChangesAll]->(d:Domain)
    
    WITH n, d, collect(type(r)) AS rights
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
           d.name AS domain,
           'DCSync' IN rights OR ('GetChanges' IN rights AND 'GetChangesAll' IN rights) AS can_dcsync,
           'GetChanges' IN rights AS has_getchanges,
           'GetChangesAll' IN rights AS has_getchangesall,
           n.enabled AS enabled
    ORDER BY can_dcsync DESC, type, n.name
    
[DEBUG] Query completed in 0.00s

[*] [CRITICAL] All DCSync Principals
    Found 4 principal(s) with replication rights
    [!] 1 principal(s) can perform FULL DCSync!
        3 principal(s) have partial replication rights

    Expected principals with DCSync:
    - Domain Controllers (group)
    - Enterprise Domain Controllers
    - Administrators

    Unexpected principals should be investigated!

+----------------------------------------------------+-------+-------------------+-------------+------------+---------------+
| Principal                                          | Type  | Domain            | Full DCSync | GetChanges | GetChangesAll |
+----------------------------------------------------+-------+-------------------+-------------+------------+---------------+
| ADMINISTRATORS@HACKSMARTER.LOCAL                   | Group | HACKSMARTER.LOCAL | True        | True       | True          |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | Group | HACKSMARTER.LOCAL | False       | False      | True          |
| ENTERPRISE DOMAIN CONTROLLERS@HACKSMARTER.LOCAL    | Group | HACKSMARTER.LOCAL | False       | True       | False         |
| ENTERPRISE READ-ONLY DOMAIN CONTROLLERS@HACKSMA... | Group | HACKSMARTER.LOCAL | False       | True       | False         |
+----------------------------------------------------+-------+-------------------+-------------+------------+---------------+
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:ReadGMSAPassword]->(g)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, g.name AS gmsa_account
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] gMSA Password Readers
    Found 0 gMSA reader(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true})
    WHERE NOT u.name STARTS WITH 'KRBTGT'
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.enabled AS enabled,
        u.admincount AS admincount,
        u.description AS description,
        u.serviceprincipalnames AS spns,
        u.pwdlastset AS pwdlastset,
        CASE
            WHEN u.pwdlastset IS NULL THEN 'Unknown'
            WHEN u.pwdlastset = 0 THEN 'Never'
            WHEN (datetime().epochSeconds - u.pwdlastset) > 31536000 THEN '>1 year'
            WHEN (datetime().epochSeconds - u.pwdlastset) > 15552000 THEN '>6 months'
            WHEN (datetime().epochSeconds - u.pwdlastset) > 7776000 THEN '>3 months'
            WHEN (datetime().epochSeconds - u.pwdlastset) > 2592000 THEN '>1 month'
            ELSE '<1 month'
        END AS pwd_age
    ORDER BY u.admincount DESC, u.pwdlastset ASC
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Kerberoastable Users (SPN Set)
    Found 1 Kerberoastable user(s)
+---------------------------+----------------+---------+-------+-----------+--------------------------------+
| Name                      | Display Name   | Enabled | Admin | Pwd Age   | SPN                            |
+---------------------------+----------------+---------+-------+-----------+--------------------------------+
| ALT.SVC@HACKSMARTER.LOCAL | Alt Cunningham | True    | False | >3 months | AI/blackwall.hacksmarter.local |
+---------------------------+----------------+---------+-------+-----------+--------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true, enabled: true})
    WHERE u.pwdlastset < (datetime().epochSeconds - (1825 * 86400))
      AND NOT u.pwdlastset IN [-1.0, 0.0]
      AND NOT u.name STARTS WITH 'KRBTGT'
      
    RETURN u.name AS name,
           u.pwdlastset AS pwdlastset,
           u.description AS description,
           u.admincount AS admincount,
           u.serviceprincipalnames AS spns
    ORDER BY u.pwdlastset ASC
    
[DEBUG] Query completed in 0.00s

[*] Kerberoastable (Stale Passwords 5+ Years)
    Found 0 Kerberoastable user(s) with stale passwords
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true, enabled: true})
    WHERE NOT u.name STARTS WITH 'KRBTGT'
    
    OPTIONAL MATCH (u)-[:AdminTo]->(c1:Computer)
    OPTIONAL MATCH (u)-[:MemberOf*1..]->(g:Group)-[:AdminTo]->(c2:Computer)
    WITH u, COLLECT(DISTINCT c1) + COLLECT(DISTINCT c2) AS computers
    WHERE SIZE(computers) > 0
    RETURN u.name AS name, SIZE(computers) AS admin_count, u.description AS description, u.serviceprincipalnames AS spns
    ORDER BY admin_count DESC
    
[DEBUG] Query completed in 0.00s

[*] Kerberoastable (With Admin Rights)
    Found 0 Kerberoastable user(s) with admin rights
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {enabled: true})
    WHERE (u.pwdlastset = u.whencreated OR u.pwdlastset = 0 OR u.pwdlastset IS NULL)
      AND u.lastlogon > (datetime().epochSeconds - (30 * 86400))
    
    RETURN u.name AS user, u.whencreated AS created, u.lastlogon AS lastlogon
    ORDER BY u.whencreated ASC
    
[DEBUG] Query completed in 0.00s

[*] Never Changed Password (Active)
    Found 0 active user(s) who never changed password
    [0.01s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.passwordnotreqd = true
    AND u.enabled = true
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.enabled AS enabled,
        u.admincount AS admincount,
        u.description AS description
    ORDER BY u.admincount DESC, u.name
    LIMIT 1000
    
[DEBUG] Query completed in 0.00s

[*] PASSWD_NOTREQD Accounts
    Found 0 account(s) with PASSWD_NOTREQD flag
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.enabled = true
    AND u.description IS NOT NULL
    AND (toLower(u.description) CONTAINS 'pass' OR toLower(u.description) CONTAINS 'pwd' OR toLower(u.description) CONTAINS 'cred')
    
    RETURN u.name AS name, u.description AS description, u.admincount AS admin
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Passwords in Description
    Found 0 user(s) with potential passwords in description
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.enabled = true
    AND u.pwdneverexpires = true
    AND u.admincount = true
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.pwdlastset AS pwdlastset,
        u.description AS description
    ORDER BY u.pwdlastset ASC
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Privileged Accounts - Pwd Never Expires
    Found 1 privileged account(s) with non-expiring passwords
+-------------------------------+----------------+--------------+-------------+
| Name                          | Display Name   | Pwd Last Set | Description |
+-------------------------------+----------------+--------------+-------------+
| THE_EMPEROR@HACKSMARTER.LOCAL | Saburo Arasaka | 1762449543.0 | -           |
+-------------------------------+----------------+--------------+-------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.enabled = true
    AND u.useraccountcontrol IS NOT NULL
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.useraccountcontrol AS uac,
        u.admincount AS admincount
    
[DEBUG] Query completed in 0.00s

[*] Reversible Encryption Enabled
    Found 0 account(s) with reversible encryption
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true})-[:AdminTo|MemberOf*1..3]->(c:Computer)
    WHERE u.enabled = true
    AND NOT u.name STARTS WITH 'KRBTGT'
    
    WITH u, collect(DISTINCT c.name) AS computers, count(DISTINCT c) AS computer_count
    RETURN
        u.name AS service_account,
        u.displayname AS display_name,
        CASE WHEN size(u.serviceprincipalnames) > 0 THEN u.serviceprincipalnames[0] ELSE null END AS primary_spn,
        computer_count,
        CASE
            WHEN computer_count > 10 THEN computers[0..10] + ['... +' + toString(computer_count - 10) + ' more']
            ELSE computers
        END AS admin_on_computers
    ORDER BY computer_count DESC
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Service Accounts with Admin Rights
    Found 0 service account(s) with admin rights (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true})
    WHERE u.enabled = true
    AND u.allowedtodelegate IS NOT NULL
    AND size(u.allowedtodelegate) > 0
    
    WITH u, u.allowedtodelegate AS targets
    // Check if any target contains DC or high-value service
    WITH u, targets,
        ANY(t IN targets WHERE
            t CONTAINS '/DC' OR
            t CONTAINS 'ldap/' OR
            t CONTAINS 'cifs/' OR
            t CONTAINS 'http/' OR
            t CONTAINS 'HOST/'
        ) AS targets_dc
    RETURN
        u.name AS service_account,
        u.displayname AS display_name,
        CASE WHEN size(u.serviceprincipalnames) > 0 THEN u.serviceprincipalnames[0] ELSE null END AS primary_spn,
        targets AS delegation_targets,
        targets_dc AS targets_high_value,
        CASE WHEN u.unconstraineddelegation = true THEN 'Yes' ELSE 'No' END AS unconstrained
    ORDER BY targets_dc DESC, u.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Service Accounts with Dangerous Delegation
    Found 0 service account(s) with delegation configured (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true})
    WHERE u.enabled = true
    AND NOT u.name STARTS WITH 'KRBTGT'
    
    OPTIONAL MATCH (u)-[:HasSession]->(c:Computer)
    OPTIONAL MATCH (u)-[:MemberOf*1..3]->(g:Group)
    WHERE g.name CONTAINS 'REMOTE DESKTOP' OR g.name CONTAINS 'RDP'
    WITH u,
        count(DISTINCT c) AS session_count,
        collect(DISTINCT g.name) AS rdp_groups
    WHERE session_count > 0 OR size(rdp_groups) > 0
    RETURN
        u.name AS service_account,
        u.displayname AS display_name,
        CASE WHEN size(u.serviceprincipalnames) > 0 THEN u.serviceprincipalnames[0] ELSE null END AS primary_spn,
        session_count,
        u.lastlogontimestamp AS last_logon,
        CASE WHEN u.admincount = true THEN 'Yes' ELSE 'No' END AS is_admin,
        rdp_groups
    ORDER BY session_count DESC, u.admincount DESC
    LIMIT 100
    
[DEBUG] Query completed in 0.01s

[*] Service Accounts with Interactive Logon
    Found 0 service account(s) with interactive logon indicators (limit 100)
    [0.01s]
[DEBUG] Query: 
    MATCH p=(n)-[:AddKeyCredentialLink]->(target)
    WHERE (n.admincount IS NULL OR n.admincount = false)
    AND NOT target.objectid ENDS WITH '-500'
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, target.name AS target, CASE
        WHEN target:User THEN 'User'
        WHEN target:Group THEN 'Group'
        WHEN target:Computer THEN 'Computer'
        WHEN target:Domain THEN 'Domain'
        WHEN target:GPO THEN 'GPO'
        WHEN target:OU THEN 'OU'
        WHEN target:Container THEN 'Container'
        WHEN target:EnterpriseCA THEN 'EnterpriseCA'
        WHEN target:CertTemplate THEN 'CertTemplate'
        WHEN target:NTAuthStore THEN 'NTAuthStore'
        WHEN target:RootCA THEN 'RootCA'
        WHEN target:AIACA THEN 'AIACA'
        ELSE labels(target)[0]
    END AS target_type
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Shadow Credentials (AddKeyCredentialLink)
    Found 0 Shadow Credential path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:HasSIDHistory]->(target)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, target.name AS sid_history_of, CASE
        WHEN target:User THEN 'User'
        WHEN target:Group THEN 'Group'
        WHEN target:Computer THEN 'Computer'
        WHEN target:Domain THEN 'Domain'
        WHEN target:GPO THEN 'GPO'
        WHEN target:OU THEN 'OU'
        WHEN target:Container THEN 'Container'
        WHEN target:EnterpriseCA THEN 'EnterpriseCA'
        WHEN target:CertTemplate THEN 'CertTemplate'
        WHEN target:NTAuthStore THEN 'NTAuthStore'
        WHEN target:RootCA THEN 'RootCA'
        WHEN target:AIACA THEN 'AIACA'
        ELSE labels(target)[0]
    END AS target_type
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] SID History Abuse
    Found 0 SID history relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE n.userpassword IS NOT NULL
    
    RETURN n.name AS name, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, n.userpassword AS password
    
[DEBUG] Query completed in 0.00s

[*] Plaintext Passwords (userPassword)
    Found 0 object(s) with userPassword attribute
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE (c.unconstraineddelegation = true
        OR (c.allowedtodelegate IS NOT NULL AND size(c.allowedtodelegate) > 0))
    AND c.enabled = true
    
    RETURN
        c.name AS computer,
        c.operatingsystem AS os,
        CASE WHEN c.unconstraineddelegation = true THEN 'Yes' ELSE 'No' END AS unconstrained,
        c.allowedtodelegate AS constrained_targets,
        CASE
            WHEN c.unconstraineddelegation = true THEN 'Unconstrained'
            WHEN c.allowedtodelegate IS NOT NULL THEN 'Constrained'
            ELSE 'None'
        END AS delegation_type,
        CASE WHEN c.objectid ENDS WITH '-516' THEN 'Yes' ELSE 'No' END AS is_dc
    ORDER BY c.unconstraineddelegation DESC, c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Computer Accounts with Delegation
    Found 1 computer(s) with delegation configured (limit 100)
    [!] 1 non-DC computer(s) have UNCONSTRAINED delegation - critical risk!
    [!] 1 non-DC computer(s) have delegation - compromise enables impersonation!
+------------------------+--------------------------------+-----------------+---------------------+-------+
| Computer               | OS                             | Delegation Type | Targets             | Is DC |
+------------------------+--------------------------------+-----------------+---------------------+-------+
| DC01.HACKSMARTER.LOCAL | WINDOWS SERVER 2022 DATACENTER | Unconstrained   | N/A (Unconstrained) | No    |
+------------------------+--------------------------------+-----------------+---------------------+-------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n:User)
    WHERE n.allowedtodelegate IS NOT NULL AND size(n.allowedtodelegate) > 0
    
    RETURN
        n.name AS name,
        'User' AS type,
        n.allowedtodelegate AS targets,
        n.enabled AS enabled
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n:Computer)
    WHERE n.allowedtodelegate IS NOT NULL AND size(n.allowedtodelegate) > 0
    
    RETURN
        n.name AS name,
        'Computer' AS type,
        n.allowedtodelegate AS targets,
        n.enabled AS enabled
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s

[*] Constrained Delegation
    Found 0 object(s) with constrained delegation
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:AllowedToDelegate]->(c:Computer)
    WHERE n.allowedtodelegate IS NOT NULL
      AND ANY(spn IN n.allowedtodelegate WHERE
          toUpper(spn) CONTAINS 'LDAP' OR
          toUpper(spn) CONTAINS 'CIFS' OR
          toUpper(spn) CONTAINS 'HOST')
    
    OPTIONAL MATCH (c)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-516'
    WITH n, c, n.allowedtodelegate AS spns, CASE WHEN g IS NOT NULL THEN 'YES' ELSE 'NO' END AS is_dc
    RETURN DISTINCT n.name AS principal, c.name AS target, spns AS delegation_targets, is_dc
    ORDER BY is_dc DESC, n.name
    
[DEBUG] Query completed in 0.00s

[*] Constrained Delegation (Dangerous Services)
    Found 0 dangerous constrained delegation(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {sensitive: false, admincount: true, enabled: true})
    
    RETURN u.name AS delegatable_admin, u.description AS description
    ORDER BY u.name
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Delegatable Admin Accounts
    Found 2 admin account(s) that can be delegated
    [!] These admins lack 'Account is sensitive and cannot be delegated'!
+---------------------------------+----------------------------------------------------+
| Delegatable Admin               | Description                                        |
+---------------------------------+----------------------------------------------------+
| ADMINISTRATOR@HACKSMARTER.LOCAL | Built-in account for administering the computer... |
| THE_EMPEROR@HACKSMARTER.LOCAL   | -                                                  |
+---------------------------------+----------------------------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (start)
    WHERE (start:User OR start:Computer)
    AND start.allowedtodelegate IS NOT NULL
    AND size(start.allowedtodelegate) > 0
    
    WITH start, start.allowedtodelegate AS targets
    UNWIND targets AS target
    WITH start, target
    WHERE target CONTAINS 'ldap/' OR target CONTAINS 'cifs/' OR target CONTAINS 'HOST/'
    // Extract hostname from SPN
    WITH start, target, split(split(target, '/')[1], '.')[0] AS target_host
    OPTIONAL MATCH (dc:Computer)
    WHERE toUpper(dc.name) STARTS WITH toUpper(target_host)
    AND (dc.objectid ENDS WITH '-516' OR dc:Tag_Tier_Zero)
    WITH start, target, dc
    WHERE dc IS NOT NULL
    RETURN DISTINCT
        start.name AS source,
        CASE WHEN start:User THEN 'User' ELSE 'Computer' END AS source_type,
        target AS delegation_target,
        dc.name AS reaches_dc,
        CASE WHEN start.admincount = true THEN 'Yes' ELSE 'No' END AS source_is_admin
    ORDER BY source_is_admin DESC, source
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Delegation Chains to High-Value
    Found 0 delegation chain(s) reaching DCs/high-value (limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[:AllowedToAct]->(c:Computer)
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        c.name AS target
    ORDER BY c.name, n.name
    
[DEBUG] Query completed in 0.00s

[*] Resource-Based Constrained Delegation (RBCD)
    Found 0 RBCD relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (p)-[:GenericAll|GenericWrite|WriteAccountRestrictions]->(c:Computer)
    WHERE NOT EXISTS {
        MATCH (p)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    }
    
    RETURN p.name AS principal, CASE
        WHEN p:User THEN 'User'
        WHEN p:Group THEN 'Group'
        WHEN p:Computer THEN 'Computer'
        WHEN p:Domain THEN 'Domain'
        WHEN p:GPO THEN 'GPO'
        WHEN p:OU THEN 'OU'
        WHEN p:Container THEN 'Container'
        WHEN p:EnterpriseCA THEN 'EnterpriseCA'
        WHEN p:CertTemplate THEN 'CertTemplate'
        WHEN p:NTAuthStore THEN 'NTAuthStore'
        WHEN p:RootCA THEN 'RootCA'
        WHEN p:AIACA THEN 'AIACA'
        ELSE labels(p)[0]
    END AS principal_type,
           c.name AS target_computer, c.domain AS domain,
           c.enabled AS enabled
    ORDER BY c.name, p.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] RBCD Attack Targets
    Found 3 potential RBCD target(s)
    [!] These computers can have RBCD configured by non-admins!
        Allows impersonation attacks via S4U2Self/S4U2Proxy

    Requirements for RBCD attack:
    1. Control over a computer account (or create one via MachineAccountQuota)
    2. Write access to target's msDS-AllowedToActOnBehalfOfOtherIdentity

        3 principal(s) can configure RBCD on 1 computer(s)
+-------------------------------------+-------+------------------------+-------------------+---------+
| Principal                           | Type  | Target Computer        | Domain            | Enabled |
+-------------------------------------+-------+------------------------+-------------------+---------+
| ADMINISTRATORS@HACKSMARTER.LOCAL    | Group | DC01.HACKSMARTER.LOCAL | HACKSMARTER.LOCAL | True    |
| DOMAIN ADMINS@HACKSMARTER.LOCAL     | Group | DC01.HACKSMARTER.LOCAL | HACKSMARTER.LOCAL | True    |
| ENTERPRISE ADMINS@HACKSMARTER.LOCAL | Group | DC01.HACKSMARTER.LOCAL | HACKSMARTER.LOCAL | True    |
+-------------------------------------+-------+------------------------+-------------------+---------+
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer {unconstraineddelegation: true})
    WHERE c.enabled = true
    AND NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-516'
    }
    
    RETURN
        c.name AS computer,
        c.operatingsystem AS os,
        c.enabled AS enabled
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] Unconstrained Delegation Targets
    Found 0 unconstrained delegation target(s) for coercion
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer {unconstraineddelegation: true})
    WHERE NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-516'
    }
    
    RETURN
        c.name AS name,
        c.operatingsystem AS os,
        c.enabled AS enabled
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] Unconstrained Delegation (Non-DC)
    Found 0 computer(s) with unconstrained delegation

[*] Domain Controllers (Unconstrained Delegation)
[DEBUG] Query: 
    MATCH (c:Computer {unconstraineddelegation: true})-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-516'
    
    RETURN DISTINCT
        c.name AS name,
        c.operatingsystem AS os
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s
    Found 1 domain controller(s)
+------------------------+--------------------------------+
| Domain Controller      | Operating System               |
+------------------------+--------------------------------+
| DC01.HACKSMARTER.LOCAL | WINDOWS SERVER 2022 DATACENTER |
+------------------------+--------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:User OR n:Computer)
    AND n.unconstraineddelegation = true
    AND n.trustedtoauthforimpersonation = true
    AND n.enabled <> false
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        n.enabled AS enabled,
        CASE WHEN n.admincount = true THEN 'Yes' ELSE 'No' END AS is_admin,
        CASE WHEN 'admin_tier_0' IN n.system_tags OR n:Tag_Tier_Zero THEN 'T0' ELSE '' END AS tier_zero,
        COALESCE(n.serviceprincipalnames, []) AS spns,
        n.domain AS domain
    ORDER BY is_admin DESC, n.name
    
[DEBUG] Query completed in 0.00s

[*] S4U2Self + Unconstrained Delegation
    Found 0 principal(s) with Protocol Transition + Unconstrained Delegation
    [0.00s]
[DEBUG] Query: 
    MATCH (u)
    WHERE (u:User OR u:Computer)
    AND u.unconstraineddelegation = true
    AND u.enabled <> false
    AND NOT u.objectid ENDS WITH '-516'
    
    RETURN u.name AS name, CASE
        WHEN u:User THEN 'User'
        WHEN u:Group THEN 'Group'
        WHEN u:Computer THEN 'Computer'
        WHEN u:Domain THEN 'Domain'
        WHEN u:GPO THEN 'GPO'
        WHEN u:OU THEN 'OU'
        WHEN u:Container THEN 'Container'
        WHEN u:EnterpriseCA THEN 'EnterpriseCA'
        WHEN u:CertTemplate THEN 'CertTemplate'
        WHEN u:NTAuthStore THEN 'NTAuthStore'
        WHEN u:RootCA THEN 'RootCA'
        WHEN u:AIACA THEN 'AIACA'
        ELSE labels(u)[0]
    END AS type, u.domain AS domain
    ORDER BY u.name
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u)
    WHERE (u:User OR u:Computer)
    AND u.unconstraineddelegation = true
    AND u.enabled <> false
    AND NOT u.objectid ENDS WITH '-516'
    
    WITH u
    MATCH (dc:Computer)
    WHERE dc.objectid ENDS WITH '-516'
    WITH u, dc
    MATCH p=shortestPath((u)-[*1..5]->(dc))
    WHERE length(p) > 0
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Unconstrained Delegation  DC Paths
    Found 0 path(s) from Unconstrained Delegation to Domain Controllers
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)-[:MemberOf*1..]->(g:Group)
    WHERE (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519' OR g.objectid ENDS WITH '-544')
    
    RETURN DISTINCT
        u.name AS name,
        u.enabled AS enabled,
        u.hasspn AS hasspn,
        u.dontreqpreauth AS asrep,
        u.unconstraineddelegation AS unconstrained,
        u.admincount AS admincount
    ORDER BY u.name
    
[DEBUG] Query completed in 0.00s

[*] Domain Admins (RID 512/519/544)
    Found 2 domain admin(s)
+---------------------------------+---------+--------+-------+---------------+
| Name                            | Enabled | HasSPN | ASREP | Unconstrained |
+---------------------------------+---------+--------+-------+---------------+
| ADMINISTRATOR@HACKSMARTER.LOCAL | True    | False  | False | False         |
| THE_EMPEROR@HACKSMARTER.LOCAL   | True    | False  | False | False         |
+---------------------------------+---------+--------+-------+---------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (d:Domain)
    
    RETURN
        d.name AS domain,
        d.functionallevel AS level
    ORDER BY d.name
    
[DEBUG] Query completed in 0.00s

[*] Domain Functional Level
    Found 1 domain(s)
+-------------------+-------+---------------------+----------+
| Domain            | Level | Windows Version     | Outdated |
+-------------------+-------+---------------------+----------+
| HACKSMARTER.LOCAL | 2016  | Windows Server 2016 | No       |
+-------------------+-------+---------------------+----------+
    [0.00s]

[*] Domain Statistics
[DEBUG] Query: 
    MATCH (n:User) 
    RETURN
        count(n) AS total,
        sum(CASE WHEN n.enabled = true THEN 1 ELSE 0 END) AS enabled,
        sum(CASE WHEN n.enabled = false THEN 1 ELSE 0 END) AS disabled,
        sum(CASE WHEN n.pwdneverexpires = true THEN 1 ELSE 0 END) AS pwd_never_expires,
        sum(CASE WHEN n.passwordnotreqd = true THEN 1 ELSE 0 END) AS pwd_not_required
    
[DEBUG] Query completed in 0.00s
    Users
+------------------------+-------+
| Metric                 | Count |
+------------------------+-------+
| Total Users            | 17    |
| Enabled                | 13    |
| Disabled               | 2     |
| Password Never Expires | 12    |
| Password Not Required  | 1     |
+------------------------+-------+
[DEBUG] Query: 
    MATCH (n:Computer) 
    RETURN
        count(n) AS total,
        sum(CASE WHEN n.enabled = true THEN 1 ELSE 0 END) AS enabled,
        sum(CASE WHEN n.haslaps = true THEN 1 ELSE 0 END) AS has_laps
    
[DEBUG] Query completed in 0.00s
    Computers
+-----------------+-------+
| Metric          | Count |
+-----------------+-------+
| Total Computers | 1     |
| Enabled         | 1     |
| LAPS Enabled    | 0     |
+-----------------+-------+
[DEBUG] Query: 
    MATCH (n:Group) 
    RETURN count(n) AS total
    
[DEBUG] Query completed in 0.00s
    Groups: 52
[DEBUG] Query: 
    MATCH (n:EnterpriseCA) 
    RETURN count(n) AS total
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n:CertTemplate) 
    RETURN count(n) AS total
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n:Computer)
    WHERE n.objectid ENDS WITH '-516' 
    RETURN count(n) AS total
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-525' 
    RETURN count(DISTINCT u) AS total
    
[DEBUG] Query completed in 0.00s
    Infrastructure
+--------------------+-------+
| Metric             | Count |
+--------------------+-------+
| Domain Controllers | 0     |
| Protected Users    | 0     |
+--------------------+-------+
[DEBUG] Query: 
    MATCH (n:User)
    
    RETURN
        count(CASE WHEN n.enabled = true THEN 1 END) AS enabled_users,
        count(n) AS total_users
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User {enabled: true})
    WHERE EXISTS {
        MATCH p=(u)-[*1..6]->(g:Group)
        WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    }
    
    RETURN count(DISTINCT u) AS users_with_path
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.enabled = true
    
    RETURN
        count(c) AS total_computers,
        count(CASE WHEN c.haslaps = false OR c.haslaps IS NULL THEN 1 END) AS no_laps
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:Tag_Tier_Zero OR 'admin_tier_0' IN n.system_tags)
    
    RETURN count(n) AS tier_zero_count
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User {enabled: true, hasspn: true})
    WHERE (u.admincount = true OR EXISTS((u)-[:AdminTo]->(:Computer)))
    
    RETURN count(DISTINCT u) AS kerberoastable_admins
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User {enabled: true, dontreqpreauth: true})
    
    RETURN count(u) AS asrep_users
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (c:Computer {unconstraineddelegation: true, enabled: true})
    WHERE NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-516'
    }
    
    RETURN count(c) AS unconstrained_non_dc
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User)-[:MemberOf*1..]->(g:Group)
    WHERE (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519')
    AND u.enabled = true
    
    RETURN count(DISTINCT u) AS domain_admin_count
    
[DEBUG] Query completed in 0.00s
    Risk Assessment
    Risk Score: 30/100 (MEDIUM)

+-----------------------------------+------------+
| Metric                            | Value      |
+-----------------------------------+------------+
| Users with path to DA             | 2 (15.4%)  |
| Computers without LAPS            | 1 (100.0%) |
| Kerberoastable Admins             | 0          |
| AS-REP Roastable Users            | 0          |
| Unconstrained Delegation (non-DC) | 0          |
| Domain Admin Count                | 2          |
| Tier Zero Objects                 | 27         |
+-----------------------------------+------------+
    [0.03s]
[DEBUG] Query: 
    MATCH (d1:Domain)-[r:TrustedBy]->(d2:Domain)
    RETURN
        d1.name AS trusting_domain,
        d2.name AS trusted_domain,
        r.trusttype AS trust_type,
        r.transitive AS transitive,
        r.sidfiltering AS sid_filtering
    ORDER BY d1.name, d2.name
    
[DEBUG] Query completed in 0.00s

[*] Domain Trusts
    Found 0 trust relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (d1:Domain)-[r:TrustedBy]->(d2:Domain)
    RETURN d1.name AS trusting_domain,
           COALESCE(r.trusttype, 'Unknown') AS trust_type,
           d2.name AS trusted_domain,
           COALESCE(r.sidfilteringenabled, true) AS sid_filtering,
           COALESCE(r.transitive, false) AS transitive
    ORDER BY d1.name
    
[DEBUG] Query completed in 0.00s

[*] Domain Trust Analysis
    Found 0 trust relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u)-[:MemberOf]->(g:Group)
    WHERE u.domain <> g.domain
    RETURN
        u.name AS user,
        u.domain AS user_domain,
        g.name AS group_name,
        g.domain AS group_domain
    ORDER BY g.domain, g.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Foreign Group Membership
    Found 0 foreign group membership(s) (limit 50)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE ('admin_tier_0' IN n.system_tags OR 'high_value' IN n.system_tags)
    
    RETURN
        n.name AS name,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        n.description AS description
    ORDER BY CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END, n.name
    
[DEBUG] Query completed in 0.00s

[*] High Value / Tier Zero Targets
    Found 27 high value/tier zero target(s)
+----------------------------------------------------+-----------+----------------------------------------------------+
| Name                                               | Type      | Description                                        |
+----------------------------------------------------+-----------+----------------------------------------------------+
| DC01.HACKSMARTER.LOCAL                             | Computer  | -                                                  |
| ADMINSDHOLDER@HACKSMARTER.LOCAL                    | Container |                                                    |
| HACKSMARTER.LOCAL                                  | Domain    |                                                    |
| DEFAULT DOMAIN CONTROLLERS POLICY@HACKSMARTER.L... | GPO       |                                                    |
| DEFAULT DOMAIN POLICY@HACKSMARTER.LOCAL            | GPO       |                                                    |
| ACCOUNT OPERATORS@HACKSMARTER.LOCAL                | Group     | Members can administer domain user and group ac... |
| ADMINISTRATORS@HACKSMARTER.LOCAL                   | Group     | Administrators have complete and unrestricted a... |
| BACKUP OPERATORS@HACKSMARTER.LOCAL                 | Group     | Backup Operators can override security restrict... |
| CERT PUBLISHERS@HACKSMARTER.LOCAL                  | Group     | Members of this group are permitted to publish ... |
| CRYPTOGRAPHIC OPERATORS@HACKSMARTER.LOCAL          | Group     | Members are authorized to perform cryptographic... |
| DISTRIBUTED COM USERS@HACKSMARTER.LOCAL            | Group     | Members are allowed to launch, activate and use... |
| DNSADMINS@HACKSMARTER.LOCAL                        | Group     | DNS Administrators Group                           |
| DOMAIN ADMINS@HACKSMARTER.LOCAL                    | Group     | Designated administrators of the domain            |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | Group     | All domain controllers in the domain               |
| ENTERPRISE ADMINS@HACKSMARTER.LOCAL                | Group     | Designated administrators of the enterprise        |
| ENTERPRISE DOMAIN CONTROLLERS@HACKSMARTER.LOCAL    | Group     | -                                                  |
| ENTERPRISE KEY ADMINS@HACKSMARTER.LOCAL            | Group     | Members of this group can perform administrativ... |
| INCOMING FOREST TRUST BUILDERS@HACKSMARTER.LOCAL   | Group     | Members of this group can create incoming, one-... |
| KEY ADMINS@HACKSMARTER.LOCAL                       | Group     | Members of this group can perform administrativ... |
| PERFORMANCE LOG USERS@HACKSMARTER.LOCAL            | Group     | Members of this group may schedule logging of p... |
| PRINT OPERATORS@HACKSMARTER.LOCAL                  | Group     | Members can administer printers installed on do... |
| SCHEMA ADMINS@HACKSMARTER.LOCAL                    | Group     | Designated administrators of the schema            |
| SERVER OPERATORS@HACKSMARTER.LOCAL                 | Group     | Members can administer domain servers              |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | OU        | Default container for domain controllers           |
| ADMINISTRATOR@HACKSMARTER.LOCAL                    | User      | Built-in account for administering the computer... |
| KRBTGT@HACKSMARTER.LOCAL                           | User      | Key Distribution Center Service Account            |
| THE_EMPEROR@HACKSMARTER.LOCAL                      | User      | -                                                  |
+----------------------------------------------------+-----------+----------------------------------------------------+
    [0.01s]
[DEBUG] Query: 
    MATCH (d:Domain)
    
    RETURN
        d.name AS domain,
        d.machineaccountquota AS maq
    
[DEBUG] Query completed in 0.00s

[*] Machine Account Quota (MAQ)
    HACKSMARTER.LOCAL: MAQ not collected
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:HasSIDHistory]->(m)
    WHERE n.domainsid = m.domainsid
    
    RETURN n.name AS principal, m.name AS sid_history_target
    ORDER BY n.name
    
[DEBUG] Query completed in 0.00s

[*] SID History (Same Domain)
    Found 0 same-domain SID history relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (d:Domain)
    
    OPTIONAL MATCH (c:Computer)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-516'
    AND toUpper(c.domain) = toUpper(d.name)
    WITH d, count(DISTINCT c) AS dc_count
    RETURN
        d.name AS domain,
        dc_count
    ORDER BY dc_count ASC, d.name
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Single Point of Failure DCs
    Found 1 domain(s) with only one DC
    [!] Single DC = no redundancy - failure impacts entire domain!
    [*] Consider adding additional Domain Controllers
+-------------------+----------+
| Domain            | DC Count |
+-------------------+----------+
| HACKSMARTER.LOCAL | 1        |
+-------------------+----------+
    [0.00s]
[DEBUG] Query: 
    MATCH (d:Domain)
    
    OPTIONAL MATCH (d)-[:Contains*1..]->(n)
    WHERE 'admin_tier_0' IN n.system_tags
    WITH d, COUNT(n) AS tier_zero_count
    RETURN d.name AS domain, tier_zero_count
    ORDER BY tier_zero_count DESC
    
[DEBUG] Query completed in 0.00s

[*] Tier Zero Principal Count
    Tier Zero principals per domain
+-------------------+-----------------+
| Domain            | Tier Zero Count |
+-------------------+-----------------+
| HACKSMARTER.LOCAL | 13              |
+-------------------+-----------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (owner)-[:Owns]->(target)
    WHERE owner.domain <> target.domain
    AND owner.domain IS NOT NULL
    AND target.domain IS NOT NULL
    RETURN owner.name AS owner, owner.domain AS owner_domain,
           target.name AS target_object, target.domain AS target_domain,
           CASE
        WHEN target:User THEN 'User'
        WHEN target:Group THEN 'Group'
        WHEN target:Computer THEN 'Computer'
        WHEN target:Domain THEN 'Domain'
        WHEN target:GPO THEN 'GPO'
        WHEN target:OU THEN 'OU'
        WHEN target:Container THEN 'Container'
        WHEN target:EnterpriseCA THEN 'EnterpriseCA'
        WHEN target:CertTemplate THEN 'CertTemplate'
        WHEN target:NTAuthStore THEN 'NTAuthStore'
        WHEN target:RootCA THEN 'RootCA'
        WHEN target:AIACA THEN 'AIACA'
        ELSE labels(target)[0]
    END AS target_type
    ORDER BY owner.domain, target.domain
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Cross-Domain Object Ownership
    Found 0 cross-domain ownership relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (d1:Domain)-[r:TrustedBy]->(d2:Domain)
    RETURN
        d1.name AS trusting_domain,
        d2.name AS trusted_domain,
        COALESCE(r.trusttype, 'Unknown') AS trust_type,
        COALESCE(r.sidfilteringenabled, true) AS sid_filtering,
        COALESCE(r.transitive, false) AS transitive,
        CASE WHEN r.sidfilteringenabled = false THEN 'VULNERABLE' ELSE 'Protected' END AS status
    ORDER BY r.sidfilteringenabled ASC, d1.name
    
[DEBUG] Query completed in 0.00s

[*] Trust SID Filtering Analysis
    Found 0 trust relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.name STARTS WITH 'AZUREADSSOACC'
    OR toLower(c.name) CONTAINS 'azureadssoacc'
    
    RETURN c.name AS computer, c.domain AS domain,
           c.enabled AS enabled, c.operatingsystem AS os,
           c.lastlogontimestamp AS last_logon,
           c.hasspn AS has_spn
    
[DEBUG] Query completed in 0.00s

[*] Azure AD SSO Account (AZUREADSSOACC)
    Found 0 AZUREADSSOACC account(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)-[r:WriteDacl|GenericAll|GenericWrite|WriteOwner]->(d:Domain)
    WHERE toUpper(g.name) CONTAINS 'EXCHANGE'
    
    RETURN
        g.name AS exchange_group,
        type(r) AS permission,
        d.name AS domain
    ORDER BY g.name
    
[DEBUG] Query completed in 0.00s

[*] Exchange Rights on Domain
    Found 0 Exchange group(s) with domain-level rights
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE toUpper(g.name) CONTAINS 'EXCHANGE WINDOWS PERMISSIONS'
       OR toUpper(g.name) CONTAINS 'ORGANIZATION MANAGEMENT'
       OR toUpper(g.name) CONTAINS 'EXCHANGE TRUSTED SUBSYSTEM'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] Exchange Privileged Groups
    Found 0 Exchange privileged group member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-548'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] Account Operators Members
    Found 0 Account Operators member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-551'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] Backup Operators Members
    Found 0 Backup Operators member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE toUpper(g.name) CONTAINS 'DNSADMINS'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] DnsAdmins Members
    Found 0 DnsAdmins member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE toUpper(g.name) CONTAINS 'GROUP POLICY CREATOR'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] GPO Creator Owners
    Found 1 GPO Creator Owners member(s)
+-----------------------------------------------+---------------------------------+------+---------+
| Group                                         | Member                          | Type | Enabled |
+-----------------------------------------------+---------------------------------+------+---------+
| GROUP POLICY CREATOR OWNERS@HACKSMARTER.LOCAL | ADMINISTRATOR@HACKSMARTER.LOCAL | User | True    |
+-----------------------------------------------+---------------------------------+------+---------+
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-550'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] Print Operators Members
    Found 0 Print Operators member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-571'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    WITH DISTINCT g, m, COALESCE(m.admincount, false) AS admincount
    RETURN
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled,
        admincount
    ORDER BY admincount DESC, member
    
[DEBUG] Query completed in 0.00s

[*] Allowed RODC Password Replication Group
    Found 0 member(s) in Allowed RODC Password Replication Group
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:User OR n:Computer)
    AND (n:Tag_Tier_Zero OR n.admincount = true)
    AND n.enabled = true
    
    WITH n
    OPTIONAL MATCH (n)-[:MemberOf*1..]->(denied:Group)
    WHERE denied.objectid ENDS WITH '-572'
    WITH n, denied
    WHERE denied IS NULL
    RETURN
        n.name AS principal,
        CASE WHEN n:User THEN 'User' WHEN n:Computer THEN 'Computer' ELSE 'Other' END AS type,
        n.domain AS domain,
        COALESCE(n.admincount, false) AS admincount
    ORDER BY type, n.name
    
[DEBUG] Query completed in 0.00s

[*] Tier Zero Missing from Denied RODC Replication
    Found 0 Tier Zero principal(s) not in Denied RODC Password Replication Group
    [0.00s]
[DEBUG] Query: 
    MATCH (m)-[:MemberOf*1..]->(g:Group)
    WHERE (g.objectid ENDS WITH '-518' OR g.objectid ENDS WITH '-519')
    AND (m:User OR m:Computer)
    AND NOT EXISTS {
        MATCH (m)-[:MemberOf*1..]->(da:Group)
        WHERE da.objectid ENDS WITH '-512'
    }
    
    RETURN DISTINCT
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' ELSE 'Other' END AS member_type,
        g.name AS high_priv_group,
        m.enabled AS enabled
    ORDER BY m.name
    
[DEBUG] Query completed in 0.00s

[*] Schema/Enterprise Admins (Non-DA)
    Found 0 Schema/Enterprise Admin(s) not in Domain Admins
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-549'
    OPTIONAL MATCH (m)-[:MemberOf*1..]->(g)
    WHERE (m:User OR m:Computer OR m:Group)
    
    RETURN DISTINCT
        g.name AS group_name,
        m.name AS member,
        CASE WHEN m:User THEN 'User' WHEN m:Computer THEN 'Computer' WHEN m:Group THEN 'Group' ELSE 'Other' END AS member_type,
        m.enabled AS enabled
    ORDER BY g.name, m.name
    
[DEBUG] Query completed in 0.00s

[*] Server Operators Members
    Found 0 Server Operators member(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    OR g.objectid ENDS WITH '-518' OR g.name =~ '(?i).*admin.*'
    
    WITH DISTINCT u
    WHERE u.enabled = true
    AND NOT EXISTS {
        MATCH (u)-[:MemberOf*1..]->(pu:Group)
        WHERE pu.objectid ENDS WITH '-525'
    }
    RETURN u.name AS user, u.domain AS domain,
           u.admincount AS is_admin,
           u.sensitive AS sensitive,
           u.lastlogontimestamp AS last_logon
    ORDER BY u.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Admins Missing from Protected Users
    Found 2 privileged user(s) NOT in Protected Users
    [!] These privileged users are NOT in Protected Users group!
        Protected Users prevents:
        - NTLM authentication (no hash exposure)
        - DES or RC4 Kerberos encryption
        - Unconstrained or constrained delegation
        - Kerberos TGT renewal beyond 4 hours

    Recommendation: Add high-privilege accounts to Protected Users
    Note: Some service accounts may break with Protected Users membership

        0 already marked sensitive (partial protection)
+---------------------------------+-------------------+------------+----------------+
| User                            | Domain            | Admin Flag | Sensitive Flag |
+---------------------------------+-------------------+------------+----------------+
| ADMINISTRATOR@HACKSMARTER.LOCAL | HACKSMARTER.LOCAL | True       | False          |
| THE_EMPEROR@HACKSMARTER.LOCAL   | HACKSMARTER.LOCAL | True       | False          |
+---------------------------------+-------------------+------------+----------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (adminsdholder:Container)
    WHERE adminsdholder.name STARTS WITH 'ADMINSDHOLDER@'
    MATCH (n)-[r]->(adminsdholder)
    WHERE type(r) IN ['GenericAll', 'GenericWrite', 'WriteDacl', 'WriteOwner', 'Owns', 'AllExtendedRights']
    AND NOT n:Tag_Tier_Zero
    AND NOT n.objectid ENDS WITH '-512'
    AND NOT n.objectid ENDS WITH '-519'
    AND NOT n.objectid ENDS WITH '-544'
    
    RETURN DISTINCT
        n.name AS principal,
        CASE WHEN n:User THEN 'User' WHEN n:Group THEN 'Group' WHEN n:Computer THEN 'Computer' ELSE 'Other' END AS type,
        type(r) AS permission,
        n.domain AS domain
    ORDER BY type(r), n.name
    
[DEBUG] Query completed in 0.00s

[*] Non-Tier Zero AdminSDHolder Controllers
    Found 0 non-Tier Zero principal(s) with AdminSDHolder control
    [0.00s]
[DEBUG] Query: 
    MATCH (n {admincount: true})
    
    RETURN CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, n.name AS name
    ORDER BY CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END, n.name
    
[DEBUG] Query completed in 0.00s

[*] AdminSDHolder Protected Objects
    Found 16 AdminSDHolder-protected object(s)
+-------+------------------------------------------------+
| Type  | Name                                           |
+-------+------------------------------------------------+
| Group | ACCOUNT OPERATORS@HACKSMARTER.LOCAL            |
| Group | ADMINISTRATORS@HACKSMARTER.LOCAL               |
| Group | BACKUP OPERATORS@HACKSMARTER.LOCAL             |
| Group | DOMAIN ADMINS@HACKSMARTER.LOCAL                |
| Group | DOMAIN CONTROLLERS@HACKSMARTER.LOCAL           |
| Group | ENTERPRISE ADMINS@HACKSMARTER.LOCAL            |
| Group | ENTERPRISE KEY ADMINS@HACKSMARTER.LOCAL        |
| Group | KEY ADMINS@HACKSMARTER.LOCAL                   |
| Group | PRINT OPERATORS@HACKSMARTER.LOCAL              |
| Group | READ-ONLY DOMAIN CONTROLLERS@HACKSMARTER.LOCAL |
| Group | REPLICATOR@HACKSMARTER.LOCAL                   |
| Group | SCHEMA ADMINS@HACKSMARTER.LOCAL                |
| Group | SERVER OPERATORS@HACKSMARTER.LOCAL             |
| User  | ADMINISTRATOR@HACKSMARTER.LOCAL                |
| User  | KRBTGT@HACKSMARTER.LOCAL                       |
| User  | THE_EMPEROR@HACKSMARTER.LOCAL                  |
+-------+------------------------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer {enabled: true})
    WHERE c.pwdlastset < (datetime().epochSeconds - (90 * 86400))
      AND c.pwdlastset > 0
    
    RETURN c.name AS computer, c.pwdlastset AS pwdlastset
    ORDER BY c.pwdlastset ASC
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Computer Stale Passwords (90+ days)
    Found 0 computer(s) with stale passwords
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    
    WHERE (c.haslaps IS NULL OR c.haslaps = false)
    AND c.enabled = true
    RETURN
        c.name AS computer,
        c.operatingsystem AS os,
        c.enabled AS enabled
    ORDER BY c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Computers Without LAPS
    Found 1 computer(s) without LAPS (enabled, limit 100)
    Breakdown by OS:
      WINDOWS SERVER 2022 DATACENTER: 1

+------------------------+--------------------------------+
| Computer               | Operating System               |
+------------------------+--------------------------------+
| DC01.HACKSMARTER.LOCAL | WINDOWS SERVER 2022 DATACENTER |
+------------------------+--------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.objectid ENDS WITH '-501'
    AND u.enabled = true
    
    RETURN u.name AS account, u.domain AS domain, u.lastlogon AS last_logon
    
[DEBUG] Query completed in 0.00s

[*] Enabled Guest Accounts
    Found 0 enabled Guest account(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.name STARTS WITH 'KRBTGT'
    
    RETURN u.name AS krbtgt, u.pwdlastset AS pwdlastset
    ORDER BY u.pwdlastset ASC
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] KRBTGT Password Age
    Found 1 KRBTGT account(s)
+--------------------------+------------------+
| KRBTGT                   | Password Age     |
+--------------------------+------------------+
| KRBTGT@HACKSMARTER.LOCAL | 105 days (0y 3m) |
+--------------------------+------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:DCFor]->(d:Domain)
    
    RETURN c.name AS dc,
           COALESCE(c.ldapsigning, 'Unknown') AS ldap_signing,
           COALESCE(c.ldapchannelbinding, 'Unknown') AS channel_binding
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] LDAP Signing/Channel Binding Status
    Found 0 DC(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:DCFor]->(d:Domain)
    WHERE c.ldapsigning = false OR c.ldapsepa = false
    
    RETURN c.name AS dc, c.ldapsigning AS ldap_signing, c.ldapsepa AS ldaps_epa, d.name AS domain
    
[DEBUG] Query completed in 0.00s

[*] LDAP Signing Disabled (Domain Controllers)
    Found 0 DC(s) with LDAP signing issues
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.scriptpath IS NOT NULL
    
    AND u.scriptpath <> ''
    AND u.enabled = true
    WITH u,
        CASE
            WHEN u.scriptpath STARTS WITH '\\\\'
            THEN split(substring(u.scriptpath, 2), '\\')[0]
            ELSE null
        END AS script_host
    WHERE script_host IS NOT NULL
    AND NOT toUpper(script_host) CONTAINS toUpper(split(u.domain, '.')[0])
    RETURN
        u.name AS user,
        u.domain AS user_domain,
        u.scriptpath AS script_path,
        script_host AS script_server
    ORDER BY u.domain, u.name
    
[DEBUG] Query completed in 0.03s

[*] Logon Scripts in Trusted Domains
    Found 0 user(s) with foreign domain logon scripts
    [0.03s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.enabled = true
    AND (c.haslaps IS NULL OR c.haslaps = false)
    AND (c.lastlogon IS NULL OR c.lastlogon = 0 OR c.lastlogon = -1)
    
    RETURN
        c.name AS computer,
        c.operatingsystem AS os,
        c.haslaps AS has_laps,
        c.description AS description
    ORDER BY c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Pre-Created Computer Accounts
    Found 0 potentially pre-created computer account(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {hasspn: true, enabled: true})
    WHERE NOT u.name STARTS WITH 'KRBTGT'
      AND NOT EXISTS {
          MATCH (u)-[:MemberOf*1..]->(g:Group)
          WHERE g.objectid ENDS WITH '-525'
      }
    
    RETURN u.name AS service_account, u.description AS description
    ORDER BY u.name
    
[DEBUG] Query completed in 0.00s

[*] [MEDIUM] Service Accounts Unprotected
    Found 1 service account(s) NOT in Protected Users
+---------------------------+----------------------+
| Service Account           | Description          |
+---------------------------+----------------------+
| ALT.SVC@HACKSMARTER.LOCAL | Trapped for eternity |
+---------------------------+----------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.enabled = true
    AND c.smbsigning = false
    
    RETURN c.name AS computer, c.operatingsystem AS os
    ORDER BY c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] SMB Signing Disabled
    Found 0 computer(s) with SMB signing disabled
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-516'
    
    RETURN c.name AS domain_controller, c.operatingsystem AS os,
           COALESCE(c.spoolersvcenabled, 'Unknown') AS spooler_enabled
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Print Spooler on DCs
    Found 1 DC(s), 0 with spooler enabled
+------------------------+--------------------------------+-----------------+
| Domain Controller      | OS                             | Spooler Enabled |
+------------------------+--------------------------------+-----------------+
| DC01.HACKSMARTER.LOCAL | WINDOWS SERVER 2022 DATACENTER | Unknown         |
+------------------------+--------------------------------+-----------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.enabled = true
    AND u.lastlogon < $cutoff
    AND u.lastlogon > 0
    
    RETURN
        u.name AS name,
        u.displayname AS displayname,
        u.admincount AS admincount,
        u.lastlogon AS lastlogon,
        u.pwdlastset AS pwdlastset
    ORDER BY u.lastlogon
    LIMIT 50
    
[DEBUG] Params: {'cutoff': 1759724459}
[DEBUG] Query completed in 0.00s

[*] [LOW] Stale User Accounts (90+ days)
    Found 1 stale account(s) (limit 50)
+---------------------------------+--------------+-------+------------+--------------+
| User                            | Display Name | Admin | Last Login | Pwd Last Set |
+---------------------------------+--------------+-------+------------+--------------+
| ADMINISTRATOR@HACKSMARTER.LOCAL | -            | True  | 2025-09-22 | 2025-09-18   |
+---------------------------------+--------------+-------+------------+--------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {admincount: true, enabled: true})
    WHERE NOT EXISTS {
        MATCH (u)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-525'
    }
    
    RETURN u.name AS admin, u.description AS description
    ORDER BY u.name
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Unprotected Admin Accounts
    Found 2 admin(s) NOT in Protected Users
    [!] Protected Users provides extra credential protection!
+---------------------------------+----------------------------------------------------+
| Unprotected Admin               | Description                                        |
+---------------------------------+----------------------------------------------------+
| ADMINISTRATOR@HACKSMARTER.LOCAL | Built-in account for administering the computer... |
| THE_EMPEROR@HACKSMARTER.LOCAL   | -                                                  |
+---------------------------------+----------------------------------------------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE c.enabled = true
    AND c.operatingsystem IS NOT NULL
    AND (c.operatingsystem =~ '(?i).*(2000|2003|2008|xp|vista|windows 7|me).*')
    
    RETURN c.name AS computer, c.operatingsystem AS os, c.lastlogon AS last_logon
    ORDER BY c.operatingsystem
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Unsupported Operating Systems
    Found 0 computer(s) with unsupported OS
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    WHERE u.enabled = true
    AND (u.lastlogon IS NULL OR u.lastlogon = 0 OR u.lastlogon = -1)
    AND (u.lastlogontimestamp IS NULL OR u.lastlogontimestamp = 0 OR u.lastlogontimestamp = -1)
    
    RETURN u.name AS name, u.displayname AS display_name, u.admincount AS admin, u.pwdlastset AS pwd_last_set
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [LOW] Users Never Logged In
    Found 8 user(s) who never logged in
    Review these accounts - they may be stale or unused
+----------------------------------+-------------------+-------+--------------+
| Name                             | Display Name      | Admin | Password Set |
+----------------------------------+-------------------+-------+--------------+
| SILVERHAND.SVC@HACKSMARTER.LOCAL | Johnny Silverhand | False | 1758466990.0 |
| ODA@HACKSMARTER.LOCAL            | Oda               | False | 1758466934.0 |
| KEI.SVC@HACKSMARTER.LOCAL        | Kei Arasaka       | False | 1758467116.0 |
| HELLMAN@HACKSMARTER.LOCAL        | Anders Hellman    | False | 1758467059.0 |
| HANAKO@HACKSMARTER.LOCAL         | Hanako Arasaka    | False | 1758466743.0 |
| GORO@HACKSMARTER.LOCAL           | Goro Takemura     | False | 1758466831.0 |
| ALT.SVC@HACKSMARTER.LOCAL        | Alt Cunningham    | False | 1758467262.0 |
| SMASHER@HACKSMARTER.LOCAL        | Adam Smasher      | False | 1758466880.0 |
+----------------------------------+-------------------+-------+--------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User)
    
    WHERE u.enabled = true
    RETURN count(u) AS total_users
    
[DEBUG] Query completed in 0.00s
[DEBUG] Query: 
    MATCH (u:User)
    
    WHERE u.enabled = true
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-512'
    MATCH p=shortestPath((u)-[*1..8]->(g))
    WITH u, min(length(p)) AS path_length
    RETURN u.name AS user, u.domain AS domain,
           u.admincount AS is_admin, path_length AS hops_to_da
    ORDER BY path_length ASC
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Users with Paths to Domain Admin
    2 of 13 users (15.4%) have paths to DA
    [!] HIGH RISK: 15.4% of users can reach Domain Admin!

        0 non-admin users have paths to DA
        2 users are within 3 hops of DA
+---------------------------------+-------------------+------------+------------+
| User                            | Domain            | Admin Flag | Hops to DA |
+---------------------------------+-------------------+------------+------------+
| THE_EMPEROR@HACKSMARTER.LOCAL   | HACKSMARTER.LOCAL | True       | 1          |
| ADMINISTRATOR@HACKSMARTER.LOCAL | HACKSMARTER.LOCAL | True       | 1          |
+---------------------------------+-------------------+------------+------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (ou:OU)<-[:Contains*1..]-(parentOU:OU)
    WHERE ou.name =~ '(?i).*(admin|tier.?0|privileged|domain controller|server).*'
    
    WITH ou
    MATCH (p)-[r:GenericAll|GenericWrite|WriteDacl|WriteOwner|Owns]->(ou)
    WHERE NOT EXISTS {
        MATCH (p)-[:MemberOf*1..]->(g:Group)
        WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    }
    RETURN p.name AS principal, CASE
        WHEN p:User THEN 'User'
        WHEN p:Group THEN 'Group'
        WHEN p:Computer THEN 'Computer'
        WHEN p:Domain THEN 'Domain'
        WHEN p:GPO THEN 'GPO'
        WHEN p:OU THEN 'OU'
        WHEN p:Container THEN 'Container'
        WHEN p:EnterpriseCA THEN 'EnterpriseCA'
        WHEN p:CertTemplate THEN 'CertTemplate'
        WHEN p:NTAuthStore THEN 'NTAuthStore'
        WHEN p:RootCA THEN 'RootCA'
        WHEN p:AIACA THEN 'AIACA'
        ELSE labels(p)[0]
    END AS principal_type,
           type(r) AS permission, ou.name AS ou_name, ou.domain AS domain
    ORDER BY ou.name, p.name
    
[DEBUG] Query completed in 0.00s

[*] Privileged OU Delegation
    Found 0 dangerous OU delegation(s)
    [0.00s]
[DEBUG] Query: 
    MATCH p=(n)-[r:CoerceAndRelayNTLMToLDAP|CoerceAndRelayNTLMToLDAPS|CoerceAndRelayNTLMToADCS|CoerceAndRelayNTLMToSMB]->(m)
    
    RETURN n.name AS source, type(r) AS relay_type, m.name AS target
    ORDER BY type(r), n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Coerce & Relay Edges
    Found 0 coerce/relay path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:HasSession]->(u:User)-[:MemberOf*1..]->(g:Group)
    WHERE (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519')
    AND c.enabled = true
    AND NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(dc:Group)
        WHERE dc.objectid ENDS WITH '-516'
    }
    
    RETURN DISTINCT
        u.name AS admin_user,
        c.name AS computer,
        c.operatingsystem AS os,
        g.name AS admin_group
    ORDER BY u.name, c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] DA Sessions on Workstations
    Found 0 Domain Admin session(s) on non-DC computers
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:ExecuteDCOM]->(c:Computer)
    WHERE (n:User OR n:Group)
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, c.name AS computer, c.operatingsystem AS os
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] DCOM Execution (Non-Admin)
    Found 0 DCOM execution path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:AdminTo]->(c:Computer)
    WHERE (n:User OR n:Group)
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN
        n.name AS principal,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        c.name AS computer,
        c.operatingsystem AS os
    ORDER BY n.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Local Admin Rights
    Found 0 local admin relationship(s) (non-DA, limit 100)
    [0.00s]
[DEBUG] Query: 
    MATCH (c1:Computer)-[:AdminTo]->(c2:Computer {signing: false})
    
    RETURN c1.name AS source, c2.name AS relay_target, c2.operatingsystem AS os
    ORDER BY c2.name
    
[DEBUG] Query completed in 0.00s

[*] NTLM Relay Targets
    Found 0 NTLM relay opportunity(ies)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:CanPSRemote]->(c:Computer)
    WHERE (n:User OR n:Group)
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, c.name AS computer, c.operatingsystem AS os
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] PowerShell Remoting Access (Non-Admin)
    Found 0 PS Remoting access path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:CanRDP]->(c:Computer)
    WHERE (n:User OR n:Group)
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, c.name AS computer, c.operatingsystem AS os
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] RDP Access (Non-Admin)
    Found 0 RDP access path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {admincount: true})-[:HasSession]->(c:Computer)
    
    RETURN
        u.name AS user,
        c.name AS computer,
        c.operatingsystem AS os
    ORDER BY u.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Active Sessions (High-Value Users)
    Found 0 session(s) of admin users (limit 50)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)-[:SQLAdmin]->(c:Computer)
    WHERE (n:User OR n:Group)
    AND (n.admincount IS NULL OR n.admincount = false)
    
    RETURN n.name AS principal, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, c.name AS sql_server, c.operatingsystem AS os
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] SQL Admin Access
    Found 0 SQL admin access path(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)
    WHERE ANY(spn IN c.serviceprincipalnames WHERE toUpper(spn) CONTAINS 'MSSQL')
    
    RETURN c.name AS computer, c.operatingsystem AS os
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] SQL Servers (SPN Discovery)
    Found 0 SQL server(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:HasSession]->(u)
    WHERE (u:Tag_Tier_Zero OR 'admin_tier_0' IN COALESCE(u.system_tags, []))
      AND NOT (c:Tag_Tier_Zero OR 'admin_tier_0' IN COALESCE(c.system_tags, []))
    
    RETURN c.name AS computer, u.name AS tier_zero_principal
    ORDER BY c.name
    
[DEBUG] Query completed in 0.00s

[*] Tier Zero Sessions on Non-T0 Hosts
    Found 0 Tier Zero session(s) exposed
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:HasSession]->(u:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-512'
    AND NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(dc_group:Group)
        WHERE dc_group.objectid ENDS WITH '-516'
    }
    
    RETURN c.name AS computer, c.operatingsystem AS os,
           u.name AS domain_admin, c.enabled AS enabled
    ORDER BY u.name, c.name
    
[DEBUG] Query completed in 0.00s

[*] DA Sessions on Non-DCs
    Found 0 DA session(s) on non-DC computers
    [0.00s]
[DEBUG] Query: 
    MATCH (c1:Computer)<-[:AdminTo]-(u:User)-[:AdminTo]->(c2:Computer)
    WHERE c1 <> c2
    AND c1.enabled = true AND c2.enabled = true
    
    WITH u, collect(DISTINCT c1.name) + collect(DISTINCT c2.name) AS computers
    WITH u, size(computers) AS computer_count, computers[0..5] AS sample_computers
    WHERE computer_count > 1
    RETURN u.name AS user, u.enabled AS enabled, computer_count AS computers_admin_to, sample_computers
    ORDER BY computer_count DESC
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Computer Admin Chains
    Found 0 user(s) who can chain between computers
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:HasSession]->(u:User)-[:MemberOf*1..]->(g:Group)
    WHERE (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
           OR g.objectid ENDS WITH '-518' OR g.name =~ '(?i).*admin.*')
    AND c.operatingsystem =~ '(?i).*server.*'
    AND NOT EXISTS {
        MATCH (c)-[:MemberOf*1..]->(dc_group:Group)
        WHERE dc_group.objectid ENDS WITH '-516'
    }
    
    WITH DISTINCT c, u
    RETURN c.name AS computer, c.operatingsystem AS os,
           u.name AS privileged_user, c.enabled AS enabled
    ORDER BY u.name, c.name
    LIMIT 100
    
[DEBUG] Query completed in 0.00s

[*] Privileged Sessions on Member Servers
    Found 0 privileged session(s) on member servers
    [0.00s]
[DEBUG] Query: 
    MATCH p=(g:Group)-[:MemberOf*2..6]->(g)
    
    RETURN DISTINCT
        g.name AS group_name,
        [n IN nodes(p) | n.name] AS cycle_path,
        length(p) AS cycle_length
    LIMIT 20
    
[DEBUG] Query completed in 0.00s

[*] Circular Group Memberships
    Found 0 circular group membership(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE n.serviceprincipalnames IS NOT NULL
    UNWIND n.serviceprincipalnames AS spn
    WITH spn, COLLECT(n.name) AS principals
    WHERE SIZE(principals) > 1
    RETURN spn AS duplicate_spn, principals
    ORDER BY spn
    
[DEBUG] Query completed in 0.00s

[*] Duplicate SPNs
    Found 0 duplicate SPN(s)
    [0.00s]
[DEBUG] Query: 
    UNWIND ['crowdstrike', 'carbonblack', 'sentinel', 'defender', 'sophos', 'symantec',
            'mcafee', 'cylance', 'fireeye', 'splunk', 'cyberark', 'tanium'] AS tool
    MATCH (n)
    WHERE toLower(n.name) CONTAINS tool OR toLower(COALESCE(n.description, '')) CONTAINS tool
    
    RETURN tool AS security_tool, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, n.name AS name
    ORDER BY tool, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END
    
[DEBUG] Query completed in 0.00s

[*] Security Tools Detection
    Found 0 security tool reference(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)-[:MemberOf*1..3]->(g:Group)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    RETURN owned.name AS owned_principal, CASE
        WHEN owned:User THEN 'User'
        WHEN owned:Group THEN 'Group'
        WHEN owned:Computer THEN 'Computer'
        WHEN owned:Domain THEN 'Domain'
        WHEN owned:GPO THEN 'GPO'
        WHEN owned:OU THEN 'OU'
        WHEN owned:Container THEN 'Container'
        WHEN owned:EnterpriseCA THEN 'EnterpriseCA'
        WHEN owned:CertTemplate THEN 'CertTemplate'
        WHEN owned:NTAuthStore THEN 'NTAuthStore'
        WHEN owned:RootCA THEN 'RootCA'
        WHEN owned:AIACA THEN 'AIACA'
        ELSE labels(owned)[0]
    END AS owned_type,
           g.name AS group_name,
           CASE WHEN 'admin_tier_0' IN g.system_tags THEN 'Yes' ELSE 'No' END AS tier_zero
    ORDER BY tier_zero DESC, owned.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Owned Group Memberships
    Found 0 group membership(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)-[:AdminTo|MemberOf*1..3]->(c:Computer)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    RETURN owned.name AS owned_principal, CASE
        WHEN owned:User THEN 'User'
        WHEN owned:Group THEN 'Group'
        WHEN owned:Computer THEN 'Computer'
        WHEN owned:Domain THEN 'Domain'
        WHEN owned:GPO THEN 'GPO'
        WHEN owned:OU THEN 'OU'
        WHEN owned:Container THEN 'Container'
        WHEN owned:EnterpriseCA THEN 'EnterpriseCA'
        WHEN owned:CertTemplate THEN 'CertTemplate'
        WHEN owned:NTAuthStore THEN 'NTAuthStore'
        WHEN owned:RootCA THEN 'RootCA'
        WHEN owned:AIACA THEN 'AIACA'
        ELSE labels(owned)[0]
    END AS owned_type,
           c.name AS computer, c.operatingsystem AS os
    ORDER BY owned.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Owned Local Admin Rights
    Found 0 local admin relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:Tag_Owned OR 'owned' IN n.system_tags OR n.owned = true)
    
    
    RETURN
        n.name AS name,
        CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type,
        n.enabled AS enabled,
        n.description AS description,
        n.admincount AS admin,
        CASE WHEN 'admin_tier_0' IN n.system_tags THEN true ELSE false END AS tier_zero
    ORDER BY CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END, n.name
    
[DEBUG] Query completed in 0.00s

[*] Owned Principals
    Found 0 owned principal(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)-[:CanRDP|MemberOf*1..3]->(c:Computer)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    RETURN owned.name AS owned_principal, CASE
        WHEN owned:User THEN 'User'
        WHEN owned:Group THEN 'Group'
        WHEN owned:Computer THEN 'Computer'
        WHEN owned:Domain THEN 'Domain'
        WHEN owned:GPO THEN 'GPO'
        WHEN owned:OU THEN 'OU'
        WHEN owned:Container THEN 'Container'
        WHEN owned:EnterpriseCA THEN 'EnterpriseCA'
        WHEN owned:CertTemplate THEN 'CertTemplate'
        WHEN owned:NTAuthStore THEN 'NTAuthStore'
        WHEN owned:RootCA THEN 'RootCA'
        WHEN owned:AIACA THEN 'AIACA'
        ELSE labels(owned)[0]
    END AS owned_type,
           c.name AS computer, c.operatingsystem AS os, c.enabled AS enabled
    ORDER BY owned.name
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Owned RDP Access
    Found 0 RDP access relationship(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    WITH owned
    MATCH p=(owned)-[*1..5]->(template:CertTemplate)-[:PublishedTo]->(ca:EnterpriseCA)
    WHERE template.enrolleesuppliessubject = true
    OR template.authenticationenabled = true
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:CertTemplate THEN 'CertTemplate'
            WHEN node:EnterpriseCA THEN 'EnterpriseCA'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length,
        template.name AS template,
        ca.name AS ca
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Owned -> ADCS Templates
    Found 0 path(s) to certificate templates
    [0.00s]
[DEBUG] Query: 
    MATCH (o)
    WHERE (o:Tag_Owned OR 'owned' IN o.system_tags OR o.owned = true)
    
    MATCH (o)-[:AdminTo|MemberOf*1..3]->(c:Computer)
    MATCH (c)-[:HasSession]->(da:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS WITH '-512'
    
    RETURN DISTINCT o.name AS owned, c.name AS target_computer, da.name AS domain_admin
    
[DEBUG] Query completed in 0.00s

[*] Owned  Admin  DA Session Chain
    Found 0 complete attack chain(s)
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    WITH owned
    MATCH (d:Domain)
    WITH owned, d
    MATCH p=shortestPath((owned)-[*1..5]->(d))
    WHERE ANY(r IN relationships(p) WHERE type(r) IN ['GetChanges', 'GetChangesAll', 'DCSync', 'AllExtendedRights', 'GenericAll'])
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Owned -> DCSync Privileges
    Found 0 path(s) to DCSync
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    WHERE (n:Tag_Owned OR 'owned' IN n.system_tags OR n.owned = true)
    
    WITH n
    MATCH (hvt)
    WHERE ('admin_tier_0' IN hvt.system_tags OR 'high_value' IN hvt.system_tags OR hvt.highvalue = true)
    AND n <> hvt
    WITH n, hvt
    MATCH p=shortestPath((n)-[*1..5]->(hvt))
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Shortest Paths: Owned -> High Value Targets
    Found 0 path(s) from owned to high value
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    WITH owned
    MATCH (target:User {hasspn: true, enabled: true})
    WHERE NOT target.name STARTS WITH 'KRBTGT'
    AND owned <> target
    WITH owned, target
    MATCH p=shortestPath((owned)-[*1..5]->(target))
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Owned -> Kerberoastable Users
    Found 0 path(s) to kerberoastable users
    [0.00s]
[DEBUG] Query: 
    MATCH (owned)
    WHERE (owned:Tag_Owned OR 'owned' IN owned.system_tags OR owned.owned = true)
    
    WITH owned
    MATCH (target)
    WHERE target.unconstraineddelegation = true
    AND owned <> target
    WITH owned, target
    MATCH p=shortestPath((owned)-[*1..5]->(target))
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Owned -> Unconstrained Delegation
    Found 0 path(s) to unconstrained delegation
    [0.00s]
[DEBUG] Query: 
    MATCH p=shortestPath((n)-[*1..5]->(g:Group))
    WHERE (n:Tag_Owned OR 'owned' IN n.system_tags OR n.owned = true)
    AND (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519')
    
    
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Shortest Paths: Owned -> Domain Admins
    Found 0 path(s) from owned principals to Domain Admins
    [0.00s]
[DEBUG] Query: 
    MATCH (u:User {dontreqpreauth: true})
    WHERE u.enabled = true
    
    WITH u
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519'
    WITH u, g
    MATCH p=shortestPath((u)-[*1..5]->(g))
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Shortest Paths: AS-REP Roastable -> Domain Admins
    Found 0 path(s) from AS-REP roastable to DA
    [0.00s]
[DEBUG] Query: 
    MATCH (c:Computer)-[:HasSession]->(u:User)
    WHERE c.domain <> u.domain
    RETURN c.name AS computer, c.domain AS computer_domain, u.name AS user, u.domain AS user_domain
    LIMIT 50
    
[DEBUG] Query completed in 0.00s

[*] Cross-Domain Sessions
    Found 0 cross-domain session(s)
    [0.00s]
[DEBUG] Query: 
    MATCH p=shortestPath((g:Group)-[*1..5]->(t))
    WHERE g.objectid ENDS WITH '-513'
      AND (t.highvalue = true OR t.objectid ENDS WITH '-512' OR t.objectid ENDS WITH '-519')
      AND g <> t
      
    RETURN
        [n IN nodes(p) | n.name] AS nodes,
        [n IN nodes(p) | CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Domain Users  High Value Targets
    Found 0 path(s) from Domain Users to high value targets
    [0.00s]
[DEBUG] Query: 
    MATCH p=shortestPath((u:User {hasspn: true})-[*1..5]->(g:Group))
    WHERE NOT u.name STARTS WITH 'KRBTGT'
    AND (g.objectid ENDS WITH '-512' OR g.objectid ENDS WITH '-519')
    
    RETURN
        [node IN nodes(p) | node.name] AS nodes,
        [node IN nodes(p) | CASE
            WHEN node:User THEN 'User'
            WHEN node:Group THEN 'Group'
            WHEN node:Computer THEN 'Computer'
            WHEN node:Domain THEN 'Domain'
            ELSE 'Other' END] AS node_types,
        [r IN relationships(p) | type(r)] AS relationships,
        length(p) AS path_length
    ORDER BY length(p)
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] Shortest Paths: Kerberoastable -> Domain Admins
    Found 0 path(s) from Kerberoastable users to Domain Admins
    [0.00s]
[DEBUG] Query: 
    MATCH (g:Group)
    WHERE g.objectid ENDS WITH '-512'
    WITH g
    MATCH (c:Computer)
    WHERE c.enabled = true
    
    WITH c, g
    MATCH p=shortestPath((c)-[*1..5]->(g))
    WITH c, min(length(p)) AS path_length
    RETURN c.name AS computer, c.operatingsystem AS os,
           c.unconstraineddelegation AS unconstrained,
           path_length AS hops_to_da
    ORDER BY path_length ASC
    LIMIT 25
    
[DEBUG] Query completed in 0.00s

[*] [HIGH] Computers with Paths to Domain Admin
    Found 1 computer(s) with paths to Domain Admins
    [!] Compromising these computers provides path to Domain Admin!
        Prioritize patching and hardening these systems.
        1 computer(s) are within 3 hops of DA
+------------------------+--------------------------------+--------------------------+------------+
| Computer               | OS                             | Unconstrained Delegation | Hops to DA |
+------------------------+--------------------------------+--------------------------+------------+
| DC01.HACKSMARTER.LOCAL | WINDOWS SERVER 2022 DATACENTER | True                     | 3          |
+------------------------+--------------------------------+--------------------------+------------+
    [0.00s]
[DEBUG] Query: 
    MATCH (n)
    
    WITH n
    OPTIONAL MATCH (n)-[r]->()
    WHERE type(r) IN ['MemberOf', 'AdminTo', 'HasSession', 'GenericAll', 'GenericWrite',
                      'WriteDacl', 'WriteOwner', 'ForceChangePassword', 'AddMember',
                      'AllExtendedRights', 'AddSelf', 'Contains', 'GPLink',
                      'Owns', 'DCSync', 'GetChanges', 'GetChangesAll']
    WITH n, count(r) AS outbound_edges
    OPTIONAL MATCH ()-[r2]->(n)
    WHERE type(r2) IN ['MemberOf', 'AdminTo', 'HasSession', 'GenericAll', 'GenericWrite',
                       'WriteDacl', 'WriteOwner', 'ForceChangePassword', 'AddMember',
                       'AllExtendedRights', 'AddSelf', 'Contains', 'GPLink',
                       'Owns', 'DCSync', 'GetChanges', 'GetChangesAll']
    WITH n, outbound_edges, count(r2) AS inbound_edges
    WHERE outbound_edges + inbound_edges > 5
    RETURN n.name AS node, CASE
        WHEN n:User THEN 'User'
        WHEN n:Group THEN 'Group'
        WHEN n:Computer THEN 'Computer'
        WHEN n:Domain THEN 'Domain'
        WHEN n:GPO THEN 'GPO'
        WHEN n:OU THEN 'OU'
        WHEN n:Container THEN 'Container'
        WHEN n:EnterpriseCA THEN 'EnterpriseCA'
        WHEN n:CertTemplate THEN 'CertTemplate'
        WHEN n:NTAuthStore THEN 'NTAuthStore'
        WHEN n:RootCA THEN 'RootCA'
        WHEN n:AIACA THEN 'AIACA'
        ELSE labels(n)[0]
    END AS type, n.domain AS domain,
           outbound_edges, inbound_edges,
           outbound_edges + inbound_edges AS total_edges
    ORDER BY total_edges DESC
    LIMIT 30
    
[DEBUG] Query completed in 0.01s

[*] [MEDIUM] Busiest Attack Path Nodes
    Found 30 high-connectivity node(s)
    [*] These nodes appear frequently in attack paths
        Securing these 'chokepoints' can disrupt many attack chains
        Breakdown: 12 groups, 14 users, 1 computers
+----------------------------------------------------+-----------+-------------------+----------+---------+-------+
| Node                                               | Type      | Domain            | Outbound | Inbound | Total |
+----------------------------------------------------+-----------+-------------------+----------+---------+-------+
| ADMINISTRATORS@HACKSMARTER.LOCAL                   | Group     | HACKSMARTER.LOCAL | 260      | 10      | 270   |
| DOMAIN ADMINS@HACKSMARTER.LOCAL                    | Group     | HACKSMARTER.LOCAL | 208      | 9       | 217   |
| ENTERPRISE ADMINS@HACKSMARTER.LOCAL                | Group     | HACKSMARTER.LOCAL | 126      | 9       | 135   |
| ACCOUNT OPERATORS@HACKSMARTER.LOCAL                | Group     | HACKSMARTER.LOCAL | 47       | 10      | 57    |
| USERS@HACKSMARTER.LOCAL                            | Container | HACKSMARTER.LOCAL | 35       | 7       | 42    |
| DOMAIN USERS@HACKSMARTER.LOCAL                     | Group     | HACKSMARTER.LOCAL | 1        | 22      | 23    |
| ADMINISTRATOR@HACKSMARTER.LOCAL                    | User      | HACKSMARTER.LOCAL | 6        | 14      | 20    |
| HACKSMARTER.LOCAL                                  | Domain    | HACKSMARTER.LOCAL | 5        | 14      | 19    |
| KRBTGT@HACKSMARTER.LOCAL                           | User      | HACKSMARTER.LOCAL | 2        | 14      | 16    |
| THE_EMPEROR@HACKSMARTER.LOCAL                      | User      | HACKSMARTER.LOCAL | 2        | 14      | 16    |
| DENIED RODC PASSWORD REPLICATION GROUP@HACKSMAR... | Group     | HACKSMARTER.LOCAL | 0        | 16      | 16    |
| YORINOBU@HACKSMARTER.LOCAL                         | User      | HACKSMARTER.LOCAL | 4        | 10      | 14    |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | Group     | HACKSMARTER.LOCAL | 2        | 12      | 14    |
| SCHEMA ADMINS@HACKSMARTER.LOCAL                    | Group     | HACKSMARTER.LOCAL | 1        | 12      | 13    |
| READ-ONLY DOMAIN CONTROLLERS@HACKSMARTER.LOCAL     | Group     | HACKSMARTER.LOCAL | 1        | 11      | 12    |
| ALT.SVC@HACKSMARTER.LOCAL                          | User      | HACKSMARTER.LOCAL | 2        | 9       | 11    |
| KEY ADMINS@HACKSMARTER.LOCAL                       | Group     | HACKSMARTER.LOCAL | 0        | 11      | 11    |
| SOULKILLER.SVC@HACKSMARTER.LOCAL                   | User      | HACKSMARTER.LOCAL | 1        | 10      | 11    |
| DOMAIN CONTROLLERS@HACKSMARTER.LOCAL               | OU        | HACKSMARTER.LOCAL | 1        | 10      | 11    |
| DC01.HACKSMARTER.LOCAL                             | Computer  | HACKSMARTER.LOCAL | 4        | 7       | 11    |
| ENTERPRISE KEY ADMINS@HACKSMARTER.LOCAL            | Group     | HACKSMARTER.LOCAL | 0        | 11      | 11    |
| GUEST@HACKSMARTER.LOCAL                            | User      | HACKSMARTER.LOCAL | 2        | 9       | 11    |
| HANAKO@HACKSMARTER.LOCAL                           | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| KEI.SVC@HACKSMARTER.LOCAL                          | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| SMASHER@HACKSMARTER.LOCAL                          | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| ODA@HACKSMARTER.LOCAL                              | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| SILVERHAND.SVC@HACKSMARTER.LOCAL                   | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| HELLMAN@HACKSMARTER.LOCAL                          | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| GORO@HACKSMARTER.LOCAL                             | User      | HACKSMARTER.LOCAL | 1        | 9       | 10    |
| RAS AND IAS SERVERS@HACKSMARTER.LOCAL              | Group     | HACKSMARTER.LOCAL | 2        | 8       | 10    |
+----------------------------------------------------+-----------+-------------------+----------+---------+-------+
    [0.01s]

[*] Findings Summary
    CRITICAL: 3 queries with findings
    HIGH: 11 queries with findings
    MEDIUM: 10 queries with findings
    LOW: 2 queries with findings

[+] Analysis completed in 0.39s
    Ran 150 queries

[*] Query Timing Summary (slowest first)
    0.03s - Logon Scripts in Trusted Domains (0 results)
    0.03s - Domain Statistics (1 results)
    0.01s - Busiest Attack Path Nodes (30 results)
    0.01s - Service Accounts with Interactive Logon (0 results)
    0.01s - Never Changed Password (Active) (0 results)
    0.01s - High Value / Tier Zero Targets (27 results)
    0.00s - Users with Paths to DA (2 results)
    0.00s - Top ACL Controllers (6 results)
    0.00s - Constrained Delegation (0 results)
    0.00s - Unconstrained Delegation (0 results)
